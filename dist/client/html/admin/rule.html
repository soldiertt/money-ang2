<div>
<h2>Rules management</h2>
<!-- CREATION FORM -->
<form (submit)="onCreate();nameCtrl.focus()" [ngFormModel]="createForm" class="form-horizontal">
  <div class="form-group">
    <label for="rule-name" class="control-label col-sm-2">Name *</label>
    <div class="col-sm-9">
      <input type="text" name="rule-name" id="rule-name" ngControl="name" #nameCtrl class="form-control" [(ngModel)]="newRule.name" />
      <display-error control="name" error="required">Name is required</display-error>
      <display-error control="name" error="minlength">Minimum length is 3 characters</display-error>
      <display-error control="name" error="maxlength">Maximum length is 50 characters</display-error>
    </div>
  </div>

  <div class="form-group" *ngFor="#condition of newRule.conditions, #i = index">
    <label class="control-label col-sm-2">Condition {{i + 1}} *</label>
    <div class="col-sm-3">
      <select class="form-control" (change)="fieldChanged(condition, $event)">
        <option value="" disabled selected>Select field</option>
        <option *ngFor="#field of fieldNames" [value]="field.index">{{field.label}}</option>
      </select>
    </div>
    <div class="col-sm-3">
      <select class="form-control" [(ngModel)]="condition.operator">
        <option *ngFor="#operator of condition.availableOperators" [value]="operator.operator">{{operator.label}}</option>
      </select>
    </div>
    <div class="col-sm-3">
      <input *ngIf="condition.fieldType == 'STRING'" type="text" class="form-control" [(ngModel)]="condition.valueStr" (keyup)="onConditionUpdated($event)" />
      <input *ngIf="condition.fieldType == 'NUMBER'" type="number" step="any" class="form-control" [(ngModel)]="condition.valueNum" (keyup)="onConditionUpdated($event)" />
    </div>
    <div class="col-sm-1" *ngIf="i + 1 == newRule.conditions.length">
      <span class="glyphicon glyphicon-plus" (click)="onAddCondition()"></span>
      <span class="glyphicon glyphicon-minus" (click)="onRemoveCondition()" *ngIf="i != 0"></span>
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2"></label>
    <div class="col-sm-9">
      <display-error control="conditions" error="wrongConditions">Conditions are required</display-error>
    </div>
  </div>

  <div class="form-group">
    <label for="cat-type" class="control-label col-sm-2">Category Type *</label>
    <div class="col-sm-9">
      <select name="cat-type" id="cat-type" ngControl="catType" class="form-control" (change)="onCatTypeChanged($event)">
        <option value="FIXED">FIXED</option>
        <option value="OTHER">OTHER</option>
        <option value="INCOMING">INCOMING</option>
      </select>
    </div>
  </div>
  <div class="form-group">
    <label for="cat-frequency" class="control-label col-sm-2">Category frequency *</label>
    <div class="col-sm-9">
      <select name="cat-frequency" id="cat-frequency" ngControl="catFrequency" class="form-control" (change)="onCatFrequencyChanged($event)">
        <option value="MONTHLY">MONTHLY</option>
        <option value="QUARTER">QUARTER</option>
        <option value="YEARLY">YEARLY</option>
      </select>
    </div>
  </div>
  <div class="form-group">
    <label for="cat-id" class="control-label col-sm-2">Category name *</label>
    <div class="col-sm-9">
      <select name="cat-id" id="cat-id" ngControl="catId" class="form-control" [(ngModel)]="newRule.category">
        <option value="" disabled selected>Select a category ...</option>
        <option *ngFor="#cat of categories | catfilter : [categoryType] : [categoryFrequency] | categorySorter" [value]="cat.id">{{cat.name}}</option>
      </select>
    </div>
  </div>

  <div class="form-group">
    <label class="control-label col-sm-2"></label>
    <div class="col-sm-9">
      <input type="submit" name="submit" value="Create" [disabled]="!createForm.valid" class="btn btn-default">
    </div>
  </div>
</form>
<!-- END CREATION FORM -->

<!-- RULES LIST -->
<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>Name</th>
      <th>Applied category</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="#rule of rules, #j = index">
      <td>{{rule.name}}</td>
      <td>{{rule.category.type}}/{{rule.category.frequency}}/{{rule.category.name}}</td>
      <td>{{rule.isActive?'ENABLED':'DISABLED'}}</td>
      <td>
          <span class="glyphicon glyphicon-trash" (click)="onDelete(rule, j)"></span>
          <span *ngIf="rule.isActive" class="glyphicon glyphicon-ban-circle" (click)="onDisable(rule)"></span>
          <span *ngIf="!rule.isActive" class="glyphicon glyphicon-ok-circle" (click)="onEnable(rule)"></span>
      </td>
    </tr>
  </tbody>
</table>
<!-- END CATEGORIES LIST -->
</div>
