var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},__param=this&&this.__param||function(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}},__extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)};System.register("model/core/tx.class",[],function(exports_1,context_1){"use strict";var Account,Tx;context_1&&context_1.id;return{setters:[],execute:function(){Account=function(){function Account(){}return Account}(),Tx=function(){function Tx(){this.ownAccount=new Account,this.thirdPartyAccount=new Account}return Tx}(),exports_1("Tx",Tx)}}}),System.register("model/core/money-enums",[],function(exports_2,context_2){"use strict";var CatType,CatFrequency,CondOperator,CondFieldType;context_2&&context_2.id;return{setters:[],execute:function(){!function(CatType){CatType[CatType.FIXED="FIXED"]="FIXED",CatType[CatType.OTHER="OTHER"]="OTHER",CatType[CatType.INCOMING="INCOMING"]="INCOMING"}(CatType||(CatType={})),exports_2("CatType",CatType),function(CatFrequency){CatFrequency[CatFrequency.MONTHLY="MONTHLY"]="MONTHLY",CatFrequency[CatFrequency.QUARTER="QUARTER"]="QUARTER",CatFrequency[CatFrequency.YEARLY="YEARLY"]="YEARLY"}(CatFrequency||(CatFrequency={})),exports_2("CatFrequency",CatFrequency),function(CondOperator){CondOperator[CondOperator.EQUAL="EQUAL"]="EQUAL",CondOperator[CondOperator.GREATERTHAN="GREATERTHAN"]="GREATERTHAN",CondOperator[CondOperator.LOWERTHAN="LOWERTHAN"]="LOWERTHAN",CondOperator[CondOperator.CONTAINS="CONTAINS"]="CONTAINS"}(CondOperator||(CondOperator={})),exports_2("CondOperator",CondOperator),function(CondFieldType){CondFieldType[CondFieldType.NUMBER="NUMBER"]="NUMBER",CondFieldType[CondFieldType.STRING="STRING"]="STRING"}(CondFieldType||(CondFieldType={})),exports_2("CondFieldType",CondFieldType)}}}),System.register("model/core/category.class",["model/core/money-enums"],function(exports_3,context_3){"use strict";var money_enums_1,Period,Category;context_3&&context_3.id;return{setters:[function(money_enums_1_1){money_enums_1=money_enums_1_1}],execute:function(){Period=function(){function Period(year,index){this.year=year,this.index=index,this.total=0,this.txList=[],this.markAsPaid=!1}return Period.prototype.addTx=function(tx){this.txList.push(tx),this.total+=tx.amount,this.markAsPaid=!1},Period}(),exports_3("Period",Period),Category=function(){function Category(name,type,frequency,years){this.name=name,this.type=type,this.frequency=frequency,this.years=years,this.nbPeriods=this._getNbPeriods(),this.periods=[];for(var i=0;i<years.length;i++)for(var j=0;j<this.nbPeriods;j++)this.periods.push(new Period(years[i],j))}return Category.prototype._getNbPeriods=function(){switch(this.frequency){case money_enums_1.CatFrequency.MONTHLY:return 12;case money_enums_1.CatFrequency.QUARTER:return 4;case money_enums_1.CatFrequency.YEARLY:return 1}},Category}(),exports_3("Category",Category)}}}),System.register("model/formutil/tx-form-data.class",["model/core/money-enums"],function(exports_4,context_4){"use strict";var money_enums_2,CategoryLink,TxFormData;context_4&&context_4.id;return{setters:[function(money_enums_2_1){money_enums_2=money_enums_2_1}],execute:function(){CategoryLink=function(){function CategoryLink(){this.categoryId=""}return CategoryLink}(),TxFormData=function(){function TxFormData(tx){this.tx=tx,tx.amount<0?this.categoryType=money_enums_2.CatType.OTHER:this.categoryType=money_enums_2.CatType.INCOMING,this.categoryFrequency=money_enums_2.CatFrequency.MONTHLY,this.categoryLink=new CategoryLink,this.resetComptaDate()}return TxFormData.prototype.resetComptaDate=function(){this.comptaDate=!1;var txDate=new Date(this.tx.date.getTime()),oneMonthAgoDate=new Date(txDate.setMonth(txDate.getMonth()-1));this.comptaMonth=oneMonthAgoDate.getMonth(),this.comptaYear=oneMonthAgoDate.getFullYear()},TxFormData}(),exports_4("TxFormData",TxFormData)}}}),System.register("service/category-rest.service",["@angular/core","@angular/http","rxjs/add/operator/map"],function(exports_5,context_5){"use strict";var core_1,http_1,CategoryRestService;context_5&&context_5.id;return{setters:[function(core_1_1){core_1=core_1_1},function(http_1_1){http_1=http_1_1},function(_1){}],execute:function(){CategoryRestService=function(){function CategoryRestService(_http){this._http=_http}return CategoryRestService.prototype.list=function(){return this._http.get("/restapi/category").map(function(res){return res.json()})},CategoryRestService.prototype.listForYear=function(year){return this._http.get("/restapi/category/search?year="+year).map(function(res){return res.json()})},CategoryRestService.prototype.existsCategoryForYear=function(categoryId,year){return this._http.get("/restapi/category/search?id="+categoryId+"&year="+year).map(function(res){return res?res.json():void 0})},CategoryRestService.prototype.create=function(newCateg){return this._http.post("/restapi/category",JSON.stringify(newCateg))},CategoryRestService.prototype.update=function(categ){return this._http.put("/restapi/category/"+categ.id,JSON.stringify(categ))},CategoryRestService.prototype.updatePeriodMarkAsPaid=function(categId,periodId,markAsPaid){var updateData={categoryId:categId,periodId:periodId,markAsPaid:markAsPaid};return this._http.put("/restapi/category/period/markAsPaid",JSON.stringify(updateData)).map(function(res){return res.json()})},CategoryRestService.prototype["delete"]=function(categId){return this._http["delete"]("/restapi/category/"+categId)},CategoryRestService.prototype.addTx=function(txFormData){return this._http.post("/restapi/category/addtx",JSON.stringify(txFormData))},CategoryRestService.prototype.removeTx=function(periodId,tx){return this._http.post("/restapi/category/removetx/"+periodId,JSON.stringify(tx))},CategoryRestService.prototype.existsTxForYears=function(categoryId,years){var yearsParam="";return years.forEach(function(year){yearsParam+="&years="+year}),this._http.get("/restapi/tx/search?categoryId="+categoryId+yearsParam).map(function(res){return!!res.json()})},CategoryRestService.prototype.findAllTxForPeriod=function(categoryId,periodId){return this._http.get("/restapi/tx/search?categoryId="+categoryId+"&periodId="+periodId).map(function(res){return res.json()})},CategoryRestService=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[http_1.Http])],CategoryRestService)}(),exports_5("CategoryRestService",CategoryRestService)}}}),System.register("model/core/txref.class",[],function(exports_6,context_6){"use strict";var Txref;context_6&&context_6.id;return{setters:[],execute:function(){Txref=function(){function Txref(ref){this.ref=ref}return Txref}(),exports_6("Txref",Txref)}}}),System.register("service/txref-rest.service",["@angular/core","@angular/http","rxjs/add/operator/map"],function(exports_7,context_7){"use strict";var core_2,http_2,TxrefRestService;context_7&&context_7.id;return{setters:[function(core_2_1){core_2=core_2_1},function(http_2_1){http_2=http_2_1},function(_2){}],execute:function(){TxrefRestService=function(){function TxrefRestService(_http){this._http=_http}return TxrefRestService.prototype.readByRefs=function(txList){var txRefsParam="";return txList.forEach(function(tx){txRefsParam+="&txref="+tx.ref}),this._http.get("/restapi/txref/find?"+txRefsParam.substr(1,txRefsParam.length-1)).map(function(res){return res.json()}).map(function(res){return res.map(function(txref){return txref.ref})})},TxrefRestService.prototype.create=function(txRef){return this._http.post("/restapi/txref",JSON.stringify(txRef))},TxrefRestService.prototype.deleteByTxref=function(txref){return this._http["delete"]("/restapi/txref/"+txref)},TxrefRestService=__decorate([core_2.Injectable(),__metadata("design:paramtypes",[http_2.Http])],TxrefRestService)}(),exports_7("TxrefRestService",TxrefRestService)}}}),System.register("comp/home/tx-details.component",["@angular/core","model/core/category.class","service/category-rest.service","service/txref-rest.service"],function(exports_8,context_8){"use strict";var core_3,category_class_1,category_rest_service_1,txref_rest_service_1,TxDetailsComponent;context_8&&context_8.id;return{setters:[function(core_3_1){core_3=core_3_1},function(category_class_1_1){category_class_1=category_class_1_1},function(category_rest_service_1_1){category_rest_service_1=category_rest_service_1_1},function(txref_rest_service_1_1){txref_rest_service_1=txref_rest_service_1_1}],execute:function(){TxDetailsComponent=function(){function TxDetailsComponent(_categoryRestService,_txrefRestService){this._categoryRestService=_categoryRestService,this._txrefRestService=_txrefRestService,this.txDeletedEmitter=new core_3.EventEmitter}return TxDetailsComponent.prototype.stringAsDate=function(dateStr){return new Date(dateStr)},TxDetailsComponent.prototype.onDeleteTx=function(tx){var _this=this;this._categoryRestService.removeTx(this.period.id,tx).subscribe(function(res){console.log("tx removed"),_this.txDeletedEmitter.emit([_this.period,tx])}),this._txrefRestService.deleteByTxref(tx.ref).subscribe(function(res){console.log("txref removed")})},__decorate([core_3.Input(),__metadata("design:type",Array)],TxDetailsComponent.prototype,"txList",void 0),__decorate([core_3.Input(),__metadata("design:type",category_class_1.Period)],TxDetailsComponent.prototype,"period",void 0),__decorate([core_3.Output("txDeleted"),__metadata("design:type",core_3.EventEmitter)],TxDetailsComponent.prototype,"txDeletedEmitter",void 0),TxDetailsComponent=__decorate([core_3.Component({selector:"money-tx-details",templateUrl:"assets/html/home/tx-details.html"}),__metadata("design:paramtypes",[category_rest_service_1.CategoryRestService,txref_rest_service_1.TxrefRestService])],TxDetailsComponent)}(),exports_8("TxDetailsComponent",TxDetailsComponent)}}}),System.register("model/core/filter-preset.class",[],function(exports_9,context_9){"use strict";var FilterPreset;context_9&&context_9.id;return{setters:[],execute:function(){FilterPreset=function(){function FilterPreset(){this.catTypeFixed=!0,this.catTypeOther=!0,this.catTypeIncoming=!0,this.catFreqMonthly=!0,this.catFreqQuarter=!0,this.catFreqYearly=!0,this.showTotals=!0}return FilterPreset.build=function(preset){var newPreset=new FilterPreset;return newPreset.catTypeFixed=preset.catTypeFixed,newPreset.catTypeOther=preset.catTypeOther,newPreset.catTypeIncoming=preset.catTypeIncoming,newPreset.catFreqMonthly=preset.catFreqMonthly,newPreset.catFreqQuarter=preset.catFreqQuarter,newPreset.catFreqYearly=preset.catFreqYearly,newPreset.showTotals=preset.showTotals,newPreset},FilterPreset.getKey=function(preset){var key="";return key+=preset.catTypeFixed?"Y":"N",key+=preset.catTypeOther?"Y":"N",key+=preset.catTypeIncoming?"Y":"N",key+=preset.catFreqMonthly?"Y":"N",key+=preset.catFreqQuarter?"Y":"N",key+=preset.catFreqYearly?"Y":"N",key+=preset.showTotals?"Y":"N"},FilterPreset}(),exports_9("FilterPreset",FilterPreset)}}}),System.register("service/display-param.service",["@angular/core","model/core/filter-preset.class"],function(exports_10,context_10){"use strict";var core_4,filter_preset_class_1,DisplayParamService;context_10&&context_10.id;return{setters:[function(core_4_1){core_4=core_4_1},function(filter_preset_class_1_1){filter_preset_class_1=filter_preset_class_1_1}],execute:function(){DisplayParamService=function(){function DisplayParamService(){this.filterPreset=new filter_preset_class_1.FilterPreset,this.filtersUpdated=new core_4.EventEmitter,this._year=(new Date).getFullYear()}return Object.defineProperty(DisplayParamService.prototype,"year",{get:function(){return this._year},set:function(year){this._year=year,this.filtersUpdated.emit("year")},enumerable:!0,configurable:!0}),DisplayParamService.prototype.hasChanged=function(){this.filtersUpdated.emit("update")},Object.defineProperty(DisplayParamService.prototype,"types",{get:function(){var types=[];return this.filterPreset.catTypeFixed&&types.push("FIXED"),this.filterPreset.catTypeOther&&types.push("OTHER"),this.filterPreset.catTypeIncoming&&types.push("INCOMING"),types},enumerable:!0,configurable:!0}),Object.defineProperty(DisplayParamService.prototype,"frequencies",{get:function(){var frequencies=[];return this.filterPreset.catFreqMonthly&&frequencies.push("MONTHLY"),this.filterPreset.catFreqQuarter&&frequencies.push("QUARTER"),this.filterPreset.catFreqYearly&&frequencies.push("YEARLY"),frequencies},enumerable:!0,configurable:!0}),DisplayParamService=__decorate([core_4.Injectable(),__metadata("design:paramtypes",[])],DisplayParamService)}(),exports_10("DisplayParamService",DisplayParamService)}}}),System.register("service/form-utils.service",["@angular/core"],function(exports_11,context_11){"use strict";var core_5,FormUtilsService;context_11&&context_11.id;return{setters:[function(core_5_1){core_5=core_5_1}],execute:function(){FormUtilsService=function(){function FormUtilsService(){}return FormUtilsService.prototype.reset=function(form){for(var controlNames=[],_i=1;_i<arguments.length;_i++)controlNames[_i-1]=arguments[_i];for(var _a=0,controlNames_1=controlNames;_a<controlNames_1.length;_a++){var controlName=controlNames_1[_a];form.controls[controlName].updateValue("")}},FormUtilsService.prototype.getAppYears=function(){for(var startYear=2015,endYear=(new Date).getFullYear(),years=[],year=startYear;endYear>=year;year++)years.push(year);return years},FormUtilsService.prototype.getAppMonths=function(){return[{value:0,name:"January"},{value:1,name:"February"},{value:2,name:"March"},{value:3,name:"April"},{value:4,name:"May"},{value:5,name:"June"},{value:6,name:"July"},{value:7,name:"Augustus"},{value:8,name:"September"},{value:9,name:"October"},{value:10,name:"November"},{value:11,name:"December"}]},FormUtilsService=__decorate([core_5.Injectable(),__metadata("design:paramtypes",[])],FormUtilsService)}(),exports_11("FormUtilsService",FormUtilsService)}}}),System.register("comp/directive/tooltip.directive",["@angular/core"],function(exports_12,context_12){"use strict";var core_6,TooltipDirective;context_12&&context_12.id;return{setters:[function(core_6_1){core_6=core_6_1}],execute:function(){TooltipDirective=function(){function TooltipDirective(el){this.displayed=!1,this.displayLeft=!1}return TooltipDirective.prototype.enable=function($event){return"true"===this.isActive&&($event.clientX-$event.offsetX+450>window.innerWidth?this.displayLeft=!0:this.displayLeft=!1,this.displayed?this.displayed=!1:this.displayed=!0),!1},TooltipDirective.prototype.startAutoClose=function(){var _this=this;this.autoClose=setTimeout(function(){_this.displayed=!1},1e3)},TooltipDirective.prototype.cancelAutoClose=function(){clearTimeout(this.autoClose)},TooltipDirective.prototype.close=function(){this.displayed=!1},__decorate([core_6.HostListener("click",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],TooltipDirective.prototype,"enable",null),__decorate([core_6.HostListener("mouseout"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],TooltipDirective.prototype,"startAutoClose",null),__decorate([core_6.HostListener("mouseover"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],TooltipDirective.prototype,"cancelAutoClose",null),__decorate([core_6.HostListener("blur"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],TooltipDirective.prototype,"close",null),TooltipDirective=__decorate([core_6.Directive({selector:"[tooltip]",inputs:["isActive : tooltip"],host:{"[class.moneytooltip]":"isActive == 'true'","[class.showtooltip]":"displayed","[class.displayleft]":"displayLeft","[tabindex]":"1"}}),__metadata("design:paramtypes",[core_6.ElementRef])],TooltipDirective)}(),exports_12("TooltipDirective",TooltipDirective)}}}),System.register("comp/directive/money-icon.directive",["@angular/core"],function(exports_13,context_13){"use strict";var core_7,MoneyIconDirective;context_13&&context_13.id;return{setters:[function(core_7_1){core_7=core_7_1}],execute:function(){MoneyIconDirective=function(){function MoneyIconDirective(){}return __decorate([core_7.Input("icon-class"),__metadata("design:type",String)],MoneyIconDirective.prototype,"iconClass",void 0),MoneyIconDirective=__decorate([core_7.Component({selector:"money-icon",template:"<span [ngClass]=\"['money-icon',iconClass.toLowerCase()]\"></span>",styleUrls:["assets/css/money-icon.css"]}),__metadata("design:paramtypes",[])],MoneyIconDirective)}(),exports_13("MoneyIconDirective",MoneyIconDirective)}}}),System.register("pipe/money-pipes",["@angular/core"],function(exports_14,context_14){"use strict";var core_8,CategorySorterPipe,PeriodFilterPipe,CatfilterPipe;context_14&&context_14.id;return{setters:[function(core_8_1){core_8=core_8_1}],execute:function(){CategorySorterPipe=function(){function CategorySorterPipe(){}return CategorySorterPipe.prototype.transform=function(array,args){return array&&array.sort(function(a,b){return a.type>b.type?1:a.type<b.type?-1:a.frequency>b.frequency?1:a.frequency<b.frequency?-1:a.name>b.name?1:a.name<b.name?-1:0}),array},CategorySorterPipe=__decorate([core_8.Pipe({name:"categorySorter"}),__metadata("design:paramtypes",[])],CategorySorterPipe)}(),exports_14("CategorySorterPipe",CategorySorterPipe),PeriodFilterPipe=function(){function PeriodFilterPipe(){}return PeriodFilterPipe.prototype.transform=function(periods,year){return periods?periods.filter(function(period){return period.year===year}):periods},PeriodFilterPipe=__decorate([core_8.Pipe({name:"periodFilter"}),__metadata("design:paramtypes",[])],PeriodFilterPipe)}(),exports_14("PeriodFilterPipe",PeriodFilterPipe),CatfilterPipe=function(){function CatfilterPipe(){}return CatfilterPipe.prototype.transform=function(categories,types,frequencies,years){if(categories){var filtered=categories.filter(function(item){return-1!==types.indexOf(item.type)&&-1!==frequencies.indexOf(item.frequency)});return years&&(filtered=filtered.filter(function(item){return years.every(function(year){return-1!==item.years.indexOf(year)})})),filtered}return categories},CatfilterPipe=__decorate([core_8.Pipe({name:"catfilter"}),__metadata("design:paramtypes",[])],CatfilterPipe)}(),exports_14("CatfilterPipe",CatfilterPipe)}}}),System.register("comp/home/money-table.component",["@angular/core","comp/home/tx-details.component","model/core/money-enums","service/display-param.service","service/category-rest.service","service/form-utils.service","comp/directive/tooltip.directive","comp/directive/money-icon.directive","pipe/money-pipes"],function(exports_15,context_15){"use strict";var core_9,tx_details_component_1,money_enums_3,display_param_service_1,category_rest_service_2,form_utils_service_1,tooltip_directive_1,money_icon_directive_1,money_pipes_1,MoneyTableComponent;context_15&&context_15.id;return{setters:[function(core_9_1){core_9=core_9_1},function(tx_details_component_1_1){tx_details_component_1=tx_details_component_1_1},function(money_enums_3_1){money_enums_3=money_enums_3_1},function(display_param_service_1_1){display_param_service_1=display_param_service_1_1},function(category_rest_service_2_1){category_rest_service_2=category_rest_service_2_1},function(form_utils_service_1_1){form_utils_service_1=form_utils_service_1_1},function(tooltip_directive_1_1){tooltip_directive_1=tooltip_directive_1_1},function(money_icon_directive_1_1){money_icon_directive_1=money_icon_directive_1_1},function(money_pipes_1_1){money_pipes_1=money_pipes_1_1}],execute:function(){MoneyTableComponent=function(){function MoneyTableComponent(displayParamService,_categoryRestService,_formUtilsService){var _this=this;this.displayParamService=displayParamService,this._categoryRestService=_categoryRestService,this._formUtilsService=_formUtilsService,this.categories=[],this.totals=new Map,this.months=this._formUtilsService.getAppMonths(),this.displayParamService.filtersUpdated.subscribe(function(item){return _this.filtersUpdated(item)}),this.displayCategories()}return MoneyTableComponent.prototype.displayCategories=function(){var _this=this;this.initTotals(!1),this._categoryRestService.listForYear(this.displayParamService.year).subscribe(function(categories){_this.categories=categories,_this.computeTotals()})},MoneyTableComponent.prototype.filtersUpdated=function(item){"year"===item?this.displayCategories():(this.initTotals(!0),this.computeSubTotals())},MoneyTableComponent.prototype.findTx=function(categoryId,period){0===period.total||period.txList||this._categoryRestService.findAllTxForPeriod(categoryId,period.id).subscribe(function(categ){period.txList=categ.periods[0].txList})},MoneyTableComponent.prototype.markPeriodAsPaid=function(category,period){this.isUnpaidPeriod(category,period)?(period.markAsPaid=!0,this._categoryRestService.updatePeriodMarkAsPaid(category.id,period.id,!0).subscribe(function(data){console.log("category updated")},function(err){return console.log(err)})):0===period.total&&period.markAsPaid&&(period.markAsPaid=!1,this._categoryRestService.updatePeriodMarkAsPaid(category.id,period.id,!1).subscribe(function(data){console.log("category updated")},function(err){return console.log(err)}))},MoneyTableComponent.prototype.onTxDeleted=function($event){var period=$event[0],tx=$event[1];period.txList=void 0,period.total=period.total-tx.amount,this.initTotals(!1),this.computeTotals()},MoneyTableComponent.prototype.isCurrentPeriod=function(categ,period){var actualdate=new Date,actualYear=actualdate.getFullYear();return categ.frequency===money_enums_3.CatFrequency.YEARLY?period.year===actualYear:categ.frequency===money_enums_3.CatFrequency.QUARTER?period.year===actualYear&&period.index===Math.floor((actualdate.getMonth()+3)/3)-1:categ.frequency===money_enums_3.CatFrequency.MONTHLY?period.year===actualYear&&period.index===actualdate.getMonth():void 0},MoneyTableComponent.prototype.isUnpaidPeriod=function(categ,period){if(categ.type!==money_enums_3.CatType.FIXED||0!==period.total||period.markAsPaid)return!1;var actualdate=new Date,actualYear=actualdate.getFullYear();return period.year<actualYear?!0:categ.frequency===money_enums_3.CatFrequency.YEARLY?!1:categ.frequency===money_enums_3.CatFrequency.QUARTER?period.index<Math.floor((actualdate.getMonth()+3)/3)-1:categ.frequency===money_enums_3.CatFrequency.MONTHLY?period.index<=actualdate.getMonth():void 0},MoneyTableComponent.prototype.initTotals=function(onlySubTotals){for(var _i=0,_a=["FIXED","OTHER","INCOMING"];_i<_a.length;_i++){var type=_a[_i];if(!onlySubTotals)for(var _b=0,_c=["MONTHLY","QUARTER","YEARLY"];_b<_c.length;_b++){var freq=_c[_b];this.totals.set(type+"-"+freq,[0,0,0,0,0,0,0,0,0,0,0,0])}this.totals.set(type,[0,0,0,0,0,0,0,0,0,0,0,0])}this.totals.set("GLOBAL",[0,0,0,0,0,0,0,0,0,0,0,0])},MoneyTableComponent.prototype.computeTotals=function(){var _this=this;this.categories.forEach(function(categ){var filteredPeriods=categ.periods.filter(function(period){return period.year===_this.displayParamService.year});if(categ.frequency===money_enums_3.CatFrequency.MONTHLY)for(var periodIndex=0;periodIndex<categ.nbPeriods;periodIndex++)_this.totals.get(categ.type+"-"+categ.frequency)[periodIndex]+=filteredPeriods[periodIndex].total;else if(categ.frequency===money_enums_3.CatFrequency.QUARTER)for(var periodIndex=0;periodIndex<categ.nbPeriods;periodIndex++)for(var i=0;3>i;i++)_this.totals.get(categ.type+"-"+categ.frequency)[3*periodIndex+i]+=filteredPeriods[periodIndex].total/3;else if(categ.frequency===money_enums_3.CatFrequency.YEARLY)for(var i=0;12>i;i++)_this.totals.get(categ.type+"-"+categ.frequency)[i]+=filteredPeriods[0].total/12}),this.computeSubTotals()},MoneyTableComponent.prototype.computeSubTotals=function(){for(var _i=0,_a=this.displayParamService.types;_i<_a.length;_i++)for(var type=_a[_i],_b=0,_c=this.displayParamService.frequencies;_b<_c.length;_b++)for(var freq=_c[_b],i=0;12>i;i++)this.totals.get(type)[i]+=this.totals.get(type+"-"+freq)[i],this.totals.get("GLOBAL")[i]+=this.totals.get(type+"-"+freq)[i]},MoneyTableComponent=__decorate([core_9.Component({selector:"money-table",templateUrl:"assets/html/home/money-table.html",styleUrls:["assets/css/money-table.css","css/tooltip.css"],directives:[tooltip_directive_1.TooltipDirective,tx_details_component_1.TxDetailsComponent,money_icon_directive_1.MoneyIconDirective],pipes:[money_pipes_1.CatfilterPipe,money_pipes_1.CategorySorterPipe,money_pipes_1.PeriodFilterPipe],encapsulation:core_9.ViewEncapsulation.None}),__metadata("design:paramtypes",[display_param_service_1.DisplayParamService,category_rest_service_2.CategoryRestService,form_utils_service_1.FormUtilsService])],MoneyTableComponent)}(),exports_15("MoneyTableComponent",MoneyTableComponent)}}}),System.register("service/filter-preset-rest.service",["@angular/core","@angular/http","rxjs/add/operator/map"],function(exports_16,context_16){"use strict";var core_10,http_3,FilterPresetRestService;context_16&&context_16.id;return{setters:[function(core_10_1){core_10=core_10_1},function(http_3_1){http_3=http_3_1},function(_3){}],execute:function(){FilterPresetRestService=function(){function FilterPresetRestService(_http){this._http=_http}return FilterPresetRestService.prototype.list=function(){return this._http.get("/restapi/filterpreset").map(function(res){return res.json()})},FilterPresetRestService.prototype.create=function(filterPreset){return this._http.post("/restapi/filterpreset",JSON.stringify(filterPreset)).map(function(res){return res.json()})},FilterPresetRestService.prototype.update=function(filterPreset){return this._http.put("/restapi/filterpreset/"+filterPreset.id,JSON.stringify(filterPreset))},FilterPresetRestService.prototype["delete"]=function(presetId){return this._http["delete"]("/restapi/filterpreset/"+presetId)},FilterPresetRestService=__decorate([core_10.Injectable(),__metadata("design:paramtypes",[http_3.Http])],FilterPresetRestService)}(),exports_16("FilterPresetRestService",FilterPresetRestService)}}}),System.register("comp/directive/focus-on-init.directive",["@angular/core"],function(exports_17,context_17){"use strict";var core_11,FocusOnInitDirective;context_17&&context_17.id;return{setters:[function(core_11_1){core_11=core_11_1}],execute:function(){FocusOnInitDirective=function(){function FocusOnInitDirective(elementRef){this.elementRef=elementRef}return FocusOnInitDirective.prototype.ngAfterViewInit=function(){this.elementRef.nativeElement.focus()},FocusOnInitDirective=__decorate([core_11.Directive({selector:"[focusOnInit]"}),__metadata("design:paramtypes",[core_11.ElementRef])],FocusOnInitDirective)}(),exports_17("FocusOnInitDirective",FocusOnInitDirective)}}}),System.register("comp/home/table-filter-form.component",["@angular/core","@angular/common","model/core/filter-preset.class","service/display-param.service","service/form-utils.service","service/filter-preset-rest.service","comp/directive/focus-on-init.directive"],function(exports_18,context_18){"use strict";var core_12,common_1,filter_preset_class_2,display_param_service_2,form_utils_service_2,filter_preset_rest_service_1,focus_on_init_directive_1,TableFilterFormComponent;context_18&&context_18.id;return{setters:[function(core_12_1){core_12=core_12_1},function(common_1_1){common_1=common_1_1},function(filter_preset_class_2_1){filter_preset_class_2=filter_preset_class_2_1},function(display_param_service_2_1){display_param_service_2=display_param_service_2_1},function(form_utils_service_2_1){form_utils_service_2=form_utils_service_2_1},function(filter_preset_rest_service_1_1){filter_preset_rest_service_1=filter_preset_rest_service_1_1},function(focus_on_init_directive_1_1){focus_on_init_directive_1=focus_on_init_directive_1_1}],execute:function(){TableFilterFormComponent=function(){function TableFilterFormComponent(displayParamService,formUtilsService,fb,_filterPresetRestService){var _this=this;this.displayParamService=displayParamService,this.formUtilsService=formUtilsService,this._filterPresetRestService=_filterPresetRestService,this.allPresets=[],this.allYears=this.formUtilsService.getAppYears(),this._filterPresetRestService.list().subscribe(function(allPresets){_this.allPresets=allPresets}),this.presetNameCtrl=fb.control("",common_1.Validators.required),this.selectedPresetCtrl=fb.control(""),this.filterForm=fb.group({presetName:this.presetNameCtrl,selectedPreset:this.selectedPresetCtrl}),this.filterForm.find("selectedPreset").valueChanges.subscribe(function(presetId){_this.loadFilter(presetId)})}return TableFilterFormComponent.prototype.loadFilter=function(presetId){if(""!==presetId){var selectedFilter=this.allPresets.filter(function(elem){return elem.id===presetId})[0];this.displayParamService.filterPreset=filter_preset_class_2.FilterPreset.build(selectedFilter),this.displayParamService.hasChanged()}},TableFilterFormComponent.prototype.notExistsCurrentFilter=function(){var actualKey=filter_preset_class_2.FilterPreset.getKey(this.displayParamService.filterPreset);return!this.allPresets.some(function(preset){return filter_preset_class_2.FilterPreset.getKey(preset)===actualKey})},TableFilterFormComponent.prototype.onFilterUpdated=function($event){this.displayParamService.hasChanged(),this.selectedPresetCtrl.updateValue("")},TableFilterFormComponent.prototype.onAskSave=function(){this.editPresetName=!0},TableFilterFormComponent.prototype.onSavePreset=function(){var _this=this;this.editPresetName=!1,this.filterForm.valid&&(this.displayParamService.filterPreset.name=this.presetNameCtrl.value,this._filterPresetRestService.create(this.displayParamService.filterPreset).subscribe(function(filterPreset){_this.allPresets.push(filterPreset)}))},TableFilterFormComponent.prototype.onCancelPreset=function(){this.editPresetName=!1},TableFilterFormComponent=__decorate([core_12.Component({selector:"money-table-filter-form",templateUrl:"assets/html/home/table-filter-form.html",styleUrls:["assets/css/table-filter-form.css"],directives:[focus_on_init_directive_1.FocusOnInitDirective]}),__metadata("design:paramtypes",[display_param_service_2.DisplayParamService,form_utils_service_2.FormUtilsService,common_1.FormBuilder,filter_preset_rest_service_1.FilterPresetRestService])],TableFilterFormComponent)}(),exports_18("TableFilterFormComponent",TableFilterFormComponent)}}}),System.register("comp/home/home.component",["@angular/core","comp/home/money-table.component","comp/home/table-filter-form.component"],function(exports_19,context_19){"use strict";var core_13,money_table_component_1,table_filter_form_component_1,HomeComponent;context_19&&context_19.id;return{setters:[function(core_13_1){core_13=core_13_1},function(money_table_component_1_1){money_table_component_1=money_table_component_1_1},function(table_filter_form_component_1_1){table_filter_form_component_1=table_filter_form_component_1_1}],execute:function(){HomeComponent=function(){function HomeComponent(){}return HomeComponent=__decorate([core_13.Component({selector:"money-home",templateUrl:"assets/html/home/index.html",directives:[money_table_component_1.MoneyTableComponent,table_filter_form_component_1.TableFilterFormComponent]}),__metadata("design:paramtypes",[])],HomeComponent)}(),exports_19("HomeComponent",HomeComponent)}}}),System.register("model/core/field-mapping.class",[],function(exports_20,context_20){"use strict";var FieldMapping;context_20&&context_20.id;
return{setters:[],execute:function(){FieldMapping=function(){function FieldMapping(value,index){this.value=value,this.index=index,this.isDateDMY=!1,this.isDateYMD=!1,this.isBelgianNumber=!1}return FieldMapping}(),exports_20("FieldMapping",FieldMapping)}}}),System.register("model/core/account-setting.class",[],function(exports_21,context_21){"use strict";var AccountSetting;context_21&&context_21.id;return{setters:[],execute:function(){AccountSetting=function(){function AccountSetting(){this.headerLinesCount=0,this.fieldSeparator=";",this.fieldMappings=[],this.generateIdentifier=!1}return AccountSetting}(),exports_21("AccountSetting",AccountSetting)}}}),System.register("model/utils/tx-mapper.class",["model/core/tx.class"],function(exports_22,context_22){"use strict";var tx_class_1,TxMapper;context_22&&context_22.id;return{setters:[function(tx_class_1_1){tx_class_1=tx_class_1_1}],execute:function(){TxMapper=function(){function TxMapper(){}return TxMapper.mapLineToTx=function(csvLine,setting){var tokens=csvLine.split(setting.fieldSeparator),outTx=new tx_class_1.Tx;return outTx.ownAccount.name=setting.name,outTx.ownAccount.number=setting.accountNumber,setting.generateIdentifier&&(outTx.ref=this.hashString(csvLine)),setting.fieldMappings.forEach(function(mapping){switch(mapping.value){case"id":outTx.ref=tokens[mapping.index];break;case"amount":if(mapping.isBelgianNumber){var amountStr=tokens[mapping.index].replace(/[.]/g,"").replace(/,/g,".");outTx.amount=100*Number(amountStr)}break;case"communication":outTx.communication=tokens[mapping.index].trim();break;case"date":var dateStr=tokens[mapping.index],parms=dateStr.split(/[\.\-\/]/),yyyy=void 0,mm=void 0,dd=void 0;mapping.isDateDMY?(yyyy=parseInt(parms[2],10),mm=parseInt(parms[1],10),dd=parseInt(parms[0],10)):mapping.isDateYMD&&(yyyy=parseInt(parms[0],10),mm=parseInt(parms[1],10),dd=parseInt(parms[2],10)),outTx.date=new Date(yyyy,mm-1,dd,0,0,0,0);break;case"description":outTx.comment=tokens[mapping.index];break;case"third-party-account-name":outTx.thirdPartyAccount.name=tokens[mapping.index];break;case"third-party-account-number":outTx.thirdPartyAccount.number=tokens[mapping.index]}}),outTx},TxMapper.hashString=function(chaine){var i,chr,len,hash=0;if(0===chaine.length)return String(hash);for(i=0,len=chaine.length;len>i;i++)chr=chaine.charCodeAt(i),hash=(hash<<5)-hash+chr,hash|=0;return String(hash)},TxMapper}(),exports_22("TxMapper",TxMapper)}}}),System.register("model/core/preference.class",[],function(exports_23,context_23){"use strict";var Preference;context_23&&context_23.id;return{setters:[],execute:function(){Preference=function(){function Preference(){this.useDefaultCsvPath=!0}return Preference}(),exports_23("Preference",Preference)}}}),System.register("service/preference-rest.service",["@angular/core","@angular/http","rxjs/add/operator/map"],function(exports_24,context_24){"use strict";var core_14,http_4,PreferenceRestService;context_24&&context_24.id;return{setters:[function(core_14_1){core_14=core_14_1},function(http_4_1){http_4=http_4_1},function(_4){}],execute:function(){PreferenceRestService=function(){function PreferenceRestService(_http){this._http=_http}return PreferenceRestService.prototype.list=function(){return this._http.get("/restapi/preference")},PreferenceRestService.prototype.getPref=function(){return this.list().map(function(res){var prefList=res.json();return prefList.length>0?prefList[0]:void 0})},PreferenceRestService.prototype.create=function(newPreference){return this._http.post("/restapi/preference",JSON.stringify(newPreference))},PreferenceRestService.prototype.update=function(newPreference){return this._http.put("/restapi/preference/"+newPreference.id,JSON.stringify(newPreference))},PreferenceRestService=__decorate([core_14.Injectable(),__metadata("design:paramtypes",[http_4.Http])],PreferenceRestService)}(),exports_24("PreferenceRestService",PreferenceRestService)}}}),System.register("service/account-setting-rest.service",["@angular/core","@angular/http","rxjs/add/operator/map"],function(exports_25,context_25){"use strict";var core_15,http_5,AccountSettingRestService;context_25&&context_25.id;return{setters:[function(core_15_1){core_15=core_15_1},function(http_5_1){http_5=http_5_1},function(_5){}],execute:function(){AccountSettingRestService=function(){function AccountSettingRestService(_http){this._http=_http}return AccountSettingRestService.prototype.list=function(){return this._http.get("/restapi/account-setting").map(function(res){return res.json()})},AccountSettingRestService.prototype.create=function(newAccountSetting){return this._http.post("/restapi/account-setting",JSON.stringify(newAccountSetting))},AccountSettingRestService.prototype["delete"]=function(accountSettingId){return this._http["delete"]("/restapi/account-setting/"+accountSettingId)},AccountSettingRestService=__decorate([core_15.Injectable(),__metadata("design:paramtypes",[http_5.Http])],AccountSettingRestService)}(),exports_25("AccountSettingRestService",AccountSettingRestService)}}}),System.register("service/csv-files-rest.service",["@angular/core","@angular/http","rxjs/add/operator/map"],function(exports_26,context_26){"use strict";var core_16,http_6,CsvFilesRestService;context_26&&context_26.id;return{setters:[function(core_16_1){core_16=core_16_1},function(http_6_1){http_6=http_6_1},function(_6){}],execute:function(){CsvFilesRestService=function(){function CsvFilesRestService(_http){this._http=_http}return CsvFilesRestService.prototype.getCsvLines=function(accountSetting,rootPath){var url="/restapi/csv/getlines?startsWith="+accountSetting.fileStartsWith+"&headerLinesCount="+accountSetting.headerLinesCount;return rootPath&&(url+="&rootPath="+encodeURIComponent(rootPath)),this._http.get(url).map(function(res){return{account:accountSetting,csvLines:res.json()}})},CsvFilesRestService.prototype.getCsvNames=function(rootPath){var url="/restapi/csv/getnames";return rootPath&&(url+="?rootPath="+encodeURIComponent(rootPath)),this._http.get(url).map(function(res){return res.json()})},CsvFilesRestService.prototype.deleteFile=function(fileName){return this._http["delete"]("/restapi/csv/delete/"+fileName).map(function(res){return res.json()})},CsvFilesRestService.prototype.getDefaultCsvPath=function(){return this._http.get("/restapi/csv/defaultpath").map(function(res){return res.json()})},CsvFilesRestService=__decorate([core_16.Injectable(),__metadata("design:paramtypes",[http_6.Http])],CsvFilesRestService)}(),exports_26("CsvFilesRestService",CsvFilesRestService)}}}),System.register("model/formutil/operator-helper.class",[],function(exports_27,context_27){"use strict";var OperatorHelper;context_27&&context_27.id;return{setters:[],execute:function(){OperatorHelper=function(){function OperatorHelper(operator,label){this.operator=operator,this.label=label}return OperatorHelper}(),exports_27("OperatorHelper",OperatorHelper)}}}),System.register("model/core/rule.class",["model/core/category.class"],function(exports_28,context_28){"use strict";var category_class_2,Condition,Rule;context_28&&context_28.id;return{setters:[function(category_class_2_1){category_class_2=category_class_2_1}],execute:function(){Condition=function(){function Condition(){}return Condition}(),exports_28("Condition",Condition),Rule=function(){function Rule(){this.conditions=[new Condition],this.isActive=!0,this.category=new category_class_2.Category(null,null,null,[])}return Rule}(),exports_28("Rule",Rule)}}}),System.register("service/rule-rest.service",["@angular/core","@angular/http","rxjs/add/operator/map"],function(exports_29,context_29){"use strict";var core_17,http_7,RuleRestService;context_29&&context_29.id;return{setters:[function(core_17_1){core_17=core_17_1},function(http_7_1){http_7=http_7_1},function(_7){}],execute:function(){RuleRestService=function(){function RuleRestService(_http){this._http=_http}return RuleRestService.prototype.list=function(){return this._http.get("/restapi/rule").map(function(res){return res.json()})},RuleRestService.prototype.create=function(rule){return this._http.post("/restapi/rule",JSON.stringify(rule)).map(function(res){return res.json()})},RuleRestService.prototype["delete"]=function(ruleId){return this._http["delete"]("/restapi/rule/"+ruleId)},RuleRestService.prototype.update=function(rule){return this._http.put("/restapi/rule/"+rule.id,JSON.stringify(rule)).map(function(res){return res.json()})},RuleRestService=__decorate([core_17.Injectable(),__metadata("design:paramtypes",[http_7.Http])],RuleRestService)}(),exports_29("RuleRestService",RuleRestService)}}}),System.register("service/rule.service",["@angular/core","service/rule-rest.service","service/category-rest.service","model/formutil/tx-form-data.class","model/core/money-enums"],function(exports_30,context_30){"use strict";var core_18,rule_rest_service_1,category_rest_service_3,tx_form_data_class_1,money_enums_4,RuleService;context_30&&context_30.id;return{setters:[function(core_18_1){core_18=core_18_1},function(rule_rest_service_1_1){rule_rest_service_1=rule_rest_service_1_1},function(category_rest_service_3_1){category_rest_service_3=category_rest_service_3_1},function(tx_form_data_class_1_1){tx_form_data_class_1=tx_form_data_class_1_1},function(money_enums_4_1){money_enums_4=money_enums_4_1}],execute:function(){RuleService=function(){function RuleService(_ruleRestService,_categoryRestService){this._ruleRestService=_ruleRestService,this._categoryRestService=_categoryRestService,this.reloadRules()}return RuleService.prototype.reloadRules=function(){var _this=this;this._ruleRestService.list().subscribe(function(rules){_this.allRules=rules})},RuleService.prototype.applyRules=function(tx,checkCategoryExists){var _this=this;void 0===checkCategoryExists&&(checkCategoryExists=!1);var out=new tx_form_data_class_1.TxFormData(tx);return this.allRules.forEach(function(rule){if(rule.isActive){var match_1=!0;if(rule.conditions.forEach(function(condition){var txField=_this.getField(tx,condition.fieldName);if(txField)switch(condition.fieldType){case money_enums_4.CondFieldType.STRING:match_1=match_1&&_this.matchStrCondition(match_1,condition,txField);break;case money_enums_4.CondFieldType.NUMBER:match_1=match_1&&_this.matchNumCondition(match_1,condition,txField)}else match_1=!1}),match_1){var categ=rule.category;out.categoryType=categ.type,out.categoryFrequency=categ.frequency,out.categoryLink.categoryId=rule.categoryId,out.appliedRule=rule.name,checkCategoryExists&&!function(comp,out,categ){comp._categoryRestService.existsCategoryForYear(out.categoryLink.categoryId,out.tx.date.getFullYear()).subscribe(function(category){category||(out.categoryLink.categoryId="",console.warn("Cannot apply rule cause category",categ.name,"is not available for year",out.tx.date.getFullYear()))})}(_this,out,categ)}}}),out},RuleService.prototype.getField=function(tx,fieldName){switch(fieldName){case"amount":return tx.amount;case"comment":return tx.comment;case"thirdPartyAccountName":return tx.thirdPartyAccount.name;case"thirdPartyAccountNumber":return tx.thirdPartyAccount.number;case"communication":return tx.communication}},RuleService.prototype.matchStrCondition=function(match,condition,txField){switch(condition.operator){case money_enums_4.CondOperator.EQUAL:match=match&&txField===condition.valueStr;break;case money_enums_4.CondOperator.CONTAINS:match=match&&-1!==txField.indexOf(condition.valueStr)}return match},RuleService.prototype.matchNumCondition=function(match,condition,txField){switch(condition.operator){case money_enums_4.CondOperator.EQUAL:match=match&&Math.abs(txField)===100*condition.valueNum;break;case money_enums_4.CondOperator.GREATERTHAN:match=match&&Math.abs(txField)>100*condition.valueNum;break;case money_enums_4.CondOperator.LOWERTHAN:match=match&&Math.abs(txField)<100*condition.valueNum}return match},RuleService=__decorate([core_18.Injectable(),__metadata("design:paramtypes",[rule_rest_service_1.RuleRestService,category_rest_service_3.CategoryRestService])],RuleService)}(),exports_30("RuleService",RuleService)}}}),System.register("comp/import/import.component",["@angular/core","rxjs/Observable","rxjs/add/observable/forkJoin","model/core/money-enums","model/core/txref.class","model/utils/tx-mapper.class","service/preference-rest.service","service/account-setting-rest.service","service/category-rest.service","service/csv-files-rest.service","service/txref-rest.service","service/rule.service","service/form-utils.service","pipe/money-pipes"],function(exports_31,context_31){"use strict";var core_19,Observable_1,money_enums_5,txref_class_1,tx_mapper_class_1,preference_rest_service_1,account_setting_rest_service_1,category_rest_service_4,csv_files_rest_service_1,txref_rest_service_2,rule_service_1,form_utils_service_3,money_pipes_2,ImportComponent;context_31&&context_31.id;return{setters:[function(core_19_1){core_19=core_19_1},function(Observable_1_1){Observable_1=Observable_1_1},function(_8){},function(money_enums_5_1){money_enums_5=money_enums_5_1},function(txref_class_1_1){txref_class_1=txref_class_1_1},function(tx_mapper_class_1_1){tx_mapper_class_1=tx_mapper_class_1_1},function(preference_rest_service_1_1){preference_rest_service_1=preference_rest_service_1_1},function(account_setting_rest_service_1_1){account_setting_rest_service_1=account_setting_rest_service_1_1},function(category_rest_service_4_1){category_rest_service_4=category_rest_service_4_1},function(csv_files_rest_service_1_1){csv_files_rest_service_1=csv_files_rest_service_1_1},function(txref_rest_service_2_1){txref_rest_service_2=txref_rest_service_2_1},function(rule_service_1_1){rule_service_1=rule_service_1_1},function(form_utils_service_3_1){form_utils_service_3=form_utils_service_3_1},function(money_pipes_2_1){money_pipes_2=money_pipes_2_1}],execute:function(){ImportComponent=function(){function ImportComponent(_prefRestService,_accountSettingRestService,_csvFilesRestService,_txrefRestService,_categoryRestService,_formUtilsService,_ruleService){this._prefRestService=_prefRestService,this._accountSettingRestService=_accountSettingRestService,this._csvFilesRestService=_csvFilesRestService,this._txrefRestService=_txrefRestService,this._categoryRestService=_categoryRestService,this._formUtilsService=_formUtilsService,this._ruleService=_ruleService,this.txFormDataList=[],this.pendingTxList=[],this.months=this._formUtilsService.getAppMonths(),this.years=this._formUtilsService.getAppYears()}return ImportComponent.prototype.ngOnInit=function(){var _this=this;this._categoryRestService.list().subscribe(function(categories){_this.allCategories=categories}),this._prefRestService.getPref().subscribe(function(preference){_this._accountSettingRestService.list().subscribe(function(accounts){var readLinesJobs=[];accounts.forEach(function(account){preference.useDefaultCsvPath?readLinesJobs.push(_this._csvFilesRestService.getCsvLines(account)):readLinesJobs.push(_this._csvFilesRestService.getCsvLines(account,preference.csvPath))}),Observable_1.Observable.forkJoin(readLinesJobs).subscribe(function(linesByAccountArray){var effectiveArray=linesByAccountArray;effectiveArray.forEach(function(linesByAccount){_this.pendingTxList=_this.pendingTxList.concat(linesByAccount.csvLines.map(function(csvLine){return tx_mapper_class_1.TxMapper.mapLineToTx(csvLine,linesByAccount.account)}))}),_this.reducePendingTxList()})})})},ImportComponent.prototype.reducePendingTxList=function(){var _this=this;this.pendingTxList=this.pendingTxList.reduce(function(reduced,tx){return reduced.some(function(tx2){return tx2.ref===tx.ref})||reduced.push(tx),reduced},[]),this.pendingTxList.sort(function(a,b){return a.date>b.date?1:a.date<b.date?-1:0}),this._txrefRestService.readByRefs(this.pendingTxList).subscribe(function(foundRefs){_this.pendingTxList=_this.pendingTxList.filter(function(tx){return-1===foundRefs.indexOf(tx.ref)}),_this.populateTxToDisplay()})},ImportComponent.prototype.populateTxToDisplay=function(){var _this=this;this.pendingTxList=this.pendingTxList.filter(function(tx){if(_this.txFormDataList.length<10){var txFormData=_this._ruleService.applyRules(tx,!0);return _this.txFormDataList.push(txFormData),!1}return!0})},ImportComponent.prototype.catTypeChanged=function($event,txFormData){txFormData.categoryType=money_enums_5.CatType[$event.target.value]},ImportComponent.prototype.catFrequencyChanged=function($event,txFormData){txFormData.categoryFrequency=money_enums_5.CatFrequency[$event.target.value]},ImportComponent.prototype.comptaDateChanged=function($event,txFormData){$event.target.checked?txFormData.comptaDate=!0:txFormData.resetComptaDate()},ImportComponent.prototype.getTxYear=function(txFormData){return txFormData.comptaDate?txFormData.comptaYear:txFormData.tx.date.getFullYear()},ImportComponent.prototype.saveAllTx=function(){var _this=this,toSaveList=this.txFormDataList.filter(function(txFormData){return!!txFormData.categoryLink.categoryId});toSaveList.forEach(function(txFormData){var comptaDate;comptaDate=txFormData.comptaDate?new Date(txFormData.comptaYear,txFormData.comptaMonth,1):txFormData.tx.date,txFormData.categoryLink.categoryYear=comptaDate.getFullYear(),function(comp,inComptaDate,txFormData){comp._categoryRestService.existsCategoryForYear(txFormData.categoryLink.categoryId,inComptaDate.getFullYear()).subscribe(function(category){category?(category.frequency===money_enums_5.CatFrequency.MONTHLY?txFormData.categoryLink.periodIndex=inComptaDate.getMonth():category.frequency===money_enums_5.CatFrequency.QUARTER?txFormData.categoryLink.periodIndex=Math.floor((inComptaDate.getMonth()+3)/3)-1:category.frequency===money_enums_5.CatFrequency.YEARLY&&(txFormData.categoryLink.periodIndex=0),comp._txrefRestService.create(new txref_class_1.Txref(txFormData.tx.ref)).subscribe(function(txrefAdded){console.log("Added tx ref")}),comp._categoryRestService.addTx(txFormData).subscribe(function(txAdded){console.log("Added tx")})):console.error("Error adding tx with ref ",txFormData.tx.ref,"category",txFormData.categoryLink.categoryId,"not available for year",inComptaDate.getFullYear())})}(_this,comptaDate,txFormData)}),this.txFormDataList=this.txFormDataList.filter(function(txFormData){return!txFormData.categoryLink.categoryId}),this.populateTxToDisplay()},ImportComponent=__decorate([core_19.Component({selector:"money-import",templateUrl:"assets/html/import/index.html",styleUrls:["assets/css/import.css"],pipes:[money_pipes_2.CatfilterPipe,money_pipes_2.CategorySorterPipe]}),__metadata("design:paramtypes",[preference_rest_service_1.PreferenceRestService,account_setting_rest_service_1.AccountSettingRestService,csv_files_rest_service_1.CsvFilesRestService,txref_rest_service_2.TxrefRestService,category_rest_service_4.CategoryRestService,form_utils_service_3.FormUtilsService,rule_service_1.RuleService])],ImportComponent)}(),exports_31("ImportComponent",ImportComponent)}}}),System.register("comp/import/auto-import.component",["@angular/core","rxjs/Observable","rxjs/add/observable/forkJoin","model/core/money-enums","model/core/txref.class","model/utils/tx-mapper.class","service/preference-rest.service","service/account-setting-rest.service","service/category-rest.service","service/csv-files-rest.service","service/txref-rest.service","service/rule.service"],function(exports_32,context_32){"use strict";var core_20,Observable_2,money_enums_6,txref_class_2,tx_mapper_class_2,preference_rest_service_2,account_setting_rest_service_2,category_rest_service_5,csv_files_rest_service_2,txref_rest_service_3,rule_service_2,LogLine,AutoImportComponent;context_32&&context_32.id;return{setters:[function(core_20_1){core_20=core_20_1},function(Observable_2_1){Observable_2=Observable_2_1},function(_9){},function(money_enums_6_1){money_enums_6=money_enums_6_1},function(txref_class_2_1){txref_class_2=txref_class_2_1},function(tx_mapper_class_2_1){tx_mapper_class_2=tx_mapper_class_2_1},function(preference_rest_service_2_1){preference_rest_service_2=preference_rest_service_2_1},function(account_setting_rest_service_2_1){account_setting_rest_service_2=account_setting_rest_service_2_1},function(category_rest_service_5_1){category_rest_service_5=category_rest_service_5_1},function(csv_files_rest_service_2_1){csv_files_rest_service_2=csv_files_rest_service_2_1},function(txref_rest_service_3_1){txref_rest_service_3=txref_rest_service_3_1},function(rule_service_2_1){rule_service_2=rule_service_2_1}],execute:function(){LogLine=function(){function LogLine(content,className){this.content=content,this.className=className}return LogLine}(),AutoImportComponent=function(){function AutoImportComponent(_prefRestService,_accountSettingRestService,_csvFilesRestService,_txrefRestService,_categoryRestService,_ruleService){this._prefRestService=_prefRestService,this._accountSettingRestService=_accountSettingRestService,this._csvFilesRestService=_csvFilesRestService,this._txrefRestService=_txrefRestService,this._categoryRestService=_categoryRestService,this._ruleService=_ruleService,this.txFormDataList=[],this.pendingTxList=[],this.importLog=[]}return AutoImportComponent.prototype.ngOnInit=function(){var _this=this;this._prefRestService.getPref().subscribe(function(preference){_this._accountSettingRestService.list().subscribe(function(accounts){var readLinesJobs=[];accounts.forEach(function(account){preference.useDefaultCsvPath?readLinesJobs.push(_this._csvFilesRestService.getCsvLines(account)):readLinesJobs.push(_this._csvFilesRestService.getCsvLines(account,preference.csvPath))}),Observable_2.Observable.forkJoin(readLinesJobs).subscribe(function(linesByAccountArray){var effectiveArray=linesByAccountArray;effectiveArray.forEach(function(linesByAccount){_this.pendingTxList=_this.pendingTxList.concat(linesByAccount.csvLines.map(function(csvLine){return tx_mapper_class_2.TxMapper.mapLineToTx(csvLine,linesByAccount.account)}))}),_this.reducePendingTxList()})})})},AutoImportComponent.prototype.reducePendingTxList=function(){var _this=this;this.pendingTxList=this.pendingTxList.reduce(function(reduced,tx){return reduced.some(function(tx2){return tx2.ref===tx.ref})||reduced.push(tx),reduced},[]),this.pendingTxList.sort(function(a,b){return a.date>b.date?1:a.date<b.date?-1:0}),this._txrefRestService.readByRefs(this.pendingTxList).subscribe(function(foundRefs){_this.pendingTxList=_this.pendingTxList.filter(function(tx){return-1===foundRefs.indexOf(tx.ref)})})},AutoImportComponent.prototype.runAutoImport=function(){var _this=this;this.pendingTxList.forEach(function(tx){var txFormData=_this._ruleService.applyRules(tx);txFormData.categoryLink.categoryId?_this.saveTx(txFormData):console.log("No rule match tx",tx)})},AutoImportComponent.prototype.saveTx=function(txFormData){var comptaDate=txFormData.tx.date;txFormData.categoryLink.categoryYear=comptaDate.getFullYear(),function(comp,inComptaDate,txFormData){comp._categoryRestService.existsCategoryForYear(txFormData.categoryLink.categoryId,inComptaDate.getFullYear()).subscribe(function(category){category?(category.frequency===money_enums_6.CatFrequency.MONTHLY?txFormData.categoryLink.periodIndex=inComptaDate.getMonth():category.frequency===money_enums_6.CatFrequency.QUARTER?txFormData.categoryLink.periodIndex=Math.floor((inComptaDate.getMonth()+3)/3)-1:category.frequency===money_enums_6.CatFrequency.YEARLY&&(txFormData.categoryLink.periodIndex=0),comp._txrefRestService.create(new txref_class_2.Txref(txFormData.tx.ref)).subscribe(function(txrefAdded){console.log("Added tx ref")}),comp._categoryRestService.addTx(txFormData).subscribe(function(txAdded){console.log("Added tx"),comp.importLog.push(new LogLine("Rule "+txFormData.appliedRule+" applied to tx "+JSON.stringify(txFormData.tx),"info"))})):comp.importLog.push(new LogLine("Missing category for year "+inComptaDate.getFullYear()+" for tx "+JSON.stringify(txFormData.tx),"warn"))})}(this,comptaDate,txFormData)},AutoImportComponent=__decorate([core_20.Component({selector:"money-auto-import",templateUrl:"assets/html/import/auto.html",styleUrls:["assets/css/import.css"]}),__metadata("design:paramtypes",[preference_rest_service_2.PreferenceRestService,account_setting_rest_service_2.AccountSettingRestService,csv_files_rest_service_2.CsvFilesRestService,txref_rest_service_3.TxrefRestService,category_rest_service_5.CategoryRestService,rule_service_2.RuleService])],AutoImportComponent)}(),exports_32("AutoImportComponent",AutoImportComponent)}}}),System.register("comp/preferences/preferences.component",["@angular/core","model/core/preference.class","service/preference-rest.service"],function(exports_33,context_33){"use strict";var core_21,preference_class_1,preference_rest_service_3,PreferencesComponent;context_33&&context_33.id;return{setters:[function(core_21_1){core_21=core_21_1},function(preference_class_1_1){preference_class_1=preference_class_1_1},function(preference_rest_service_3_1){preference_rest_service_3=preference_rest_service_3_1}],execute:function(){PreferencesComponent=function(){function PreferencesComponent(_preferenceRestService){this._preferenceRestService=_preferenceRestService,this.preference=new preference_class_1.Preference}return PreferencesComponent.prototype.ngOnInit=function(){var _this=this;this._preferenceRestService.list().subscribe(function(data){var prefList=data.json();prefList.length>0?_this.preference=prefList[0]:_this.preference=new preference_class_1.Preference})},PreferencesComponent.prototype.onSave=function(){var _this=this;this.preference.id?this._preferenceRestService.update(this.preference).subscribe(function(response){_this.preference=response.json(),console.log("Preferences were updated")}):this._preferenceRestService.create(this.preference).subscribe(function(response){_this.preference=response.json(),console.log("Preferences were saved")})},PreferencesComponent=__decorate([core_21.Component({selector:"money-preferences",templateUrl:"assets/html/preferences/index.html",directives:[]}),__metadata("design:paramtypes",[preference_rest_service_3.PreferenceRestService])],PreferencesComponent)}(),exports_33("PreferencesComponent",PreferencesComponent)}}}),System.register("model/utils/category-years-checker",["@angular/core","model/core/category.class"],function(exports_34,context_34){"use strict";var core_22,category_class_3,CategoryYearsChecker;context_34&&context_34.id;return{setters:[function(core_22_1){core_22=core_22_1},function(category_class_3_1){category_class_3=category_class_3_1}],execute:function(){CategoryYearsChecker=function(){function CategoryYearsChecker(){}return CategoryYearsChecker.prototype.removedYears=function(oldYears,newYears){return oldYears.filter(function(oldYear){return-1===newYears.indexOf(oldYear)})},CategoryYearsChecker.prototype.addedYears=function(oldYears,newYears){return newYears.filter(function(newYear){return-1===oldYears.indexOf(newYear)})},CategoryYearsChecker.prototype.addMissingPeriods=function(category,addedYears){return addedYears.forEach(function(addedYear){for(var i=0;i<category.nbPeriods;i++)category.periods.push(new category_class_3.Period(addedYear,i))}),category},CategoryYearsChecker.prototype.removedOldPeriods=function(category,removedYears){return category.periods=category.periods.filter(function(period){return-1===removedYears.indexOf(period.year)}),category},CategoryYearsChecker=__decorate([core_22.Injectable(),__metadata("design:paramtypes",[])],CategoryYearsChecker)}(),exports_34("CategoryYearsChecker",CategoryYearsChecker)}}}),System.register("comp/directive/display-error.directive",["@angular/core","@angular/common"],function(exports_35,context_35){"use strict";var core_23,common_2,DisplayErrorDirective;context_35&&context_35.id;return{setters:[function(core_23_1){core_23=core_23_1},function(common_2_1){common_2=common_2_1}],execute:function(){DisplayErrorDirective=function(){function DisplayErrorDirective(formModel){this.formModel=formModel}return DisplayErrorDirective.prototype.ngOnInit=function(){this.control=this.formModel.form.find(this.controlName)},DisplayErrorDirective.prototype.isDisplayed=function(){return(this.control.dirty||"csvfile"===this.controlName)&&this.control.hasError(this.error)},__decorate([core_23.Input("control"),__metadata("design:type",String)],DisplayErrorDirective.prototype,"controlName",void 0),__decorate([core_23.Input(),__metadata("design:type",String)],DisplayErrorDirective.prototype,"error",void 0),DisplayErrorDirective=__decorate([core_23.Component({selector:"display-error",template:'<div *ngIf="isDisplayed()" class="alert alert-danger"><ng-content></ng-content></div>'}),__param(0,core_23.Host()),__metadata("design:paramtypes",[common_2.NgFormModel])],DisplayErrorDirective)}(),exports_35("DisplayErrorDirective",DisplayErrorDirective)}}}),System.register("comp/admin/admin-menu.component",["@angular/core"],function(exports_36,context_36){"use strict";var core_24,AdminMenuComponent;context_36&&context_36.id;return{setters:[function(core_24_1){core_24=core_24_1}],execute:function(){AdminMenuComponent=function(){function AdminMenuComponent(){}return AdminMenuComponent.prototype.isCurrent=function(item){return item===this.current},__decorate([core_24.Input("current"),__metadata("design:type",String)],AdminMenuComponent.prototype,"current",void 0),AdminMenuComponent=__decorate([core_24.Component({selector:"money-admin-menu",templateUrl:"assets/html/admin/leftmenu.html",styleUrls:["assets/css/admin/menu.css"]}),__metadata("design:paramtypes",[])],AdminMenuComponent)}(),exports_36("AdminMenuComponent",AdminMenuComponent)}}}),System.register("comp/admin/admin-category.component",["@angular/core","@angular/common","model/core/category.class","model/core/money-enums","model/utils/category-years-checker","service/category-rest.service","service/form-utils.service","comp/directive/display-error.directive","comp/directive/focus-on-init.directive","pipe/money-pipes","comp/admin/admin-menu.component"],function(exports_37,context_37){"use strict";var core_25,common_3,category_class_4,money_enums_7,category_years_checker_1,category_rest_service_6,form_utils_service_4,display_error_directive_1,focus_on_init_directive_2,money_pipes_3,admin_menu_component_1,AdminCategoryComponent;context_37&&context_37.id;return{setters:[function(core_25_1){core_25=core_25_1},function(common_3_1){common_3=common_3_1},function(category_class_4_1){category_class_4=category_class_4_1},function(money_enums_7_1){money_enums_7=money_enums_7_1},function(category_years_checker_1_1){category_years_checker_1=category_years_checker_1_1},function(category_rest_service_6_1){category_rest_service_6=category_rest_service_6_1},function(form_utils_service_4_1){form_utils_service_4=form_utils_service_4_1},function(display_error_directive_1_1){display_error_directive_1=display_error_directive_1_1},function(focus_on_init_directive_2_1){focus_on_init_directive_2=focus_on_init_directive_2_1},function(money_pipes_3_1){money_pipes_3=money_pipes_3_1},function(admin_menu_component_1_1){admin_menu_component_1=admin_menu_component_1_1}],execute:function(){AdminCategoryComponent=function(){function AdminCategoryComponent(_categoryRestService,_formUtilsService,_categoryYearsChecker,fb){var _this=this;this._categoryRestService=_categoryRestService,this._formUtilsService=_formUtilsService,this._categoryYearsChecker=_categoryYearsChecker,this.txExistsForRemovedYears=!1,this.yearList=_formUtilsService.getAppYears(),this._categoryRestService.list().subscribe(function(categories){_this.categories=categories}),this.createForm=fb.group({name:fb.control("",common_3.Validators.compose([common_3.Validators.required,common_3.Validators.minLength(3),common_3.Validators.maxLength(50)])),type:fb.control("",common_3.Validators.required),frequency:fb.control("",common_3.Validators.required),years:fb.control([],common_3.Validators.required)}),this.editForm=fb.group({years:fb.control([],common_3.Validators.compose([common_3.Validators.required]))})}return AdminCategoryComponent.prototype.yearsValueChange=function(event){var allSelectedYears=[];for(var i in event.target.selectedOptions)event.target.selectedOptions[i].value&&allSelectedYears.push(Number(event.target.selectedOptions[i].value));
this.createForm.controls.years.updateValue(allSelectedYears)},AdminCategoryComponent.prototype.yearsEditValueChange=function(event){var allSelectedYears=[];for(var i in event.target.selectedOptions)event.target.selectedOptions[i].value&&allSelectedYears.push(Number(event.target.selectedOptions[i].value));this.editForm.controls.years.updateValue(allSelectedYears)},AdminCategoryComponent.prototype.onCreate=function(){var _this=this,controls=this.createForm.controls,newCateg=new category_class_4.Category(controls.name.value,money_enums_7.CatType[controls.type.value],money_enums_7.CatFrequency[controls.frequency.value],controls.years.value);this._categoryRestService.create(newCateg).subscribe(function(response){_this.categories.push(response.json()),_this._formUtilsService.reset(_this.createForm,"name","type","frequency","years")},function(err){return console.log(err)})},AdminCategoryComponent.prototype.bulkCreate=function($event){$event.preventDefault();var categs=[];categs.push(new category_class_4.Category("Assurance voiture",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Crèche Liam",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Crédit Hypoth. Argenta",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Electricité",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Li Yun : Beobank",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Li Yun : Proximus",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Maylee : repas/garderies",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Syndicat Smals",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("TV / Internet / Tel.",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Charges Verdurmen-Remy",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.QUARTER,[2016])),categs.push(new category_class_4.Category("Li Yun : syndicat CSC",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.QUARTER,[2016])),categs.push(new category_class_4.Category("Mutuelle FMSB",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.QUARTER,[2016])),categs.push(new category_class_4.Category("Ass. home Argenta",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.YEARLY,[2016])),categs.push(new category_class_4.Category("Ass. vie Argenta",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.YEARLY,[2016])),categs.push(new category_class_4.Category("Précompte immobilier",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.YEARLY,[2016])),categs.push(new category_class_4.Category("Contributions voiture",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.YEARLY,[2016])),categs.push(new category_class_4.Category("Décompte des charges",money_enums_7.CatType.FIXED,money_enums_7.CatFrequency.YEARLY,[2016])),categs.push(new category_class_4.Category("Autres entrants",money_enums_7.CatType.INCOMING,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Salaire SMALS",money_enums_7.CatType.INCOMING,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Remb. FMSB",money_enums_7.CatType.INCOMING,money_enums_7.CatFrequency.QUARTER,[2016])),categs.push(new category_class_4.Category("Contributions",money_enums_7.CatType.INCOMING,money_enums_7.CatFrequency.YEARLY,[2016])),categs.push(new category_class_4.Category("Argent de poche",money_enums_7.CatType.OTHER,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Carburant",money_enums_7.CatType.OTHER,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Divers",money_enums_7.CatType.OTHER,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Frais enfants",money_enums_7.CatType.OTHER,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Informatique / Loisirs",money_enums_7.CatType.OTHER,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Li Yun",money_enums_7.CatType.OTHER,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Nourriture",money_enums_7.CatType.OTHER,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Pharmacie / Médecins",money_enums_7.CatType.OTHER,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Resto / Sorties",money_enums_7.CatType.OTHER,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Vêtements / acc.",money_enums_7.CatType.OTHER,money_enums_7.CatFrequency.MONTHLY,[2016])),categs.push(new category_class_4.Category("Frais voitures",money_enums_7.CatType.OTHER,money_enums_7.CatFrequency.QUARTER,[2016])),categs.push(new category_class_4.Category("Mobilier / Accessoires",money_enums_7.CatType.OTHER,money_enums_7.CatFrequency.QUARTER,[2016]));for(var _i=0,categs_1=categs;_i<categs_1.length;_i++){var newCateg=categs_1[_i];this._categoryRestService.create(newCateg).subscribe(function(response){},function(err){return console.log(err)})}},AdminCategoryComponent.prototype.onEdit=function(category){this.editedCat=category,this.editForm.controls.years.updateValue(category.years)},AdminCategoryComponent.prototype.onCancelEdit=function($event){$event.preventDefault(),this.editedCat=void 0,this.txExistsForRemovedYears=!1},AdminCategoryComponent.prototype.onUpdate=function(){var _this=this,controls=this.editForm.controls,removedYears=this._categoryYearsChecker.removedYears(this.editedCat.years,controls.years.value),addedYears=this._categoryYearsChecker.addedYears(this.editedCat.years,controls.years.value);removedYears.length>0?this._categoryRestService.existsTxForYears(this.editedCat.id,removedYears).subscribe(function(exists){exists?_this.txExistsForRemovedYears=!0:_this.updateOk(controls,removedYears,addedYears)},function(err){return console.log(err)}):addedYears.length>0?this.updateOk(controls,removedYears,addedYears):this.editedCat=void 0},AdminCategoryComponent.prototype.updateOk=function(controls,removedYears,addedYears){var _this=this;this.txExistsForRemovedYears=!1,this.editedCat=this._categoryYearsChecker.addMissingPeriods(this.editedCat,addedYears),this.editedCat=this._categoryYearsChecker.removedOldPeriods(this.editedCat,removedYears),this.editedCat.years=controls.years.value,this._categoryRestService.update(this.editedCat).subscribe(function(response){_this.editedCat=void 0},function(err){return console.log(err)})},AdminCategoryComponent.prototype.onDelete=function(category){var _this=this,categIndex=this.categories.indexOf(category);categIndex>-1?this._categoryRestService.existsTxForYears(category.id,category.years).subscribe(function(exists){exists?console.error("Cannot delete category containing transactions !"):_this._categoryRestService["delete"](category.id).subscribe(function(response){_this.categories.splice(categIndex,1)})},function(err){return console.log(err)}):console.error("Cannot find category to delete with id ",category.id)},AdminCategoryComponent=__decorate([core_25.Component({selector:"money-admin-category",templateUrl:"assets/html/admin/category.html",directives:[display_error_directive_1.DisplayErrorDirective,focus_on_init_directive_2.FocusOnInitDirective,admin_menu_component_1.AdminMenuComponent],pipes:[money_pipes_3.CategorySorterPipe]}),__metadata("design:paramtypes",[category_rest_service_6.CategoryRestService,form_utils_service_4.FormUtilsService,category_years_checker_1.CategoryYearsChecker,common_3.FormBuilder])],AdminCategoryComponent)}(),exports_37("AdminCategoryComponent",AdminCategoryComponent)}}}),System.register("model/validation/rule-condition-validator.class",["model/core/money-enums"],function(exports_38,context_38){"use strict";var money_enums_8,RuleConditionValidator;context_38&&context_38.id;return{setters:[function(money_enums_8_1){money_enums_8=money_enums_8_1}],execute:function(){RuleConditionValidator=function(){function RuleConditionValidator(component){var validator=this;validator.validate=function(control){return validator.validateConditions(component)}}return RuleConditionValidator.prototype.validateConditions=function(component){for(var valid=!0,_i=0,_a=component.newRule.conditions;_i<_a.length;_i++){var condition=_a[_i];if(condition.fieldName&&condition.fieldType&&condition.operator)switch(condition.fieldType){case money_enums_8.CondFieldType.STRING:condition.valueStr||(valid=!1);break;case money_enums_8.CondFieldType.NUMBER:condition.valueNum||(valid=!1)}else valid=!1}return valid?null:{wrongConditions:!0}},RuleConditionValidator}(),exports_38("RuleConditionValidator",RuleConditionValidator)}}}),System.register("comp/admin/admin-rule.component",["@angular/core","@angular/common","model/core/rule.class","model/formutil/operator-helper.class","model/core/money-enums","model/validation/rule-condition-validator.class","service/rule-rest.service","service/rule.service","service/category-rest.service","comp/directive/display-error.directive","pipe/money-pipes","comp/admin/admin-menu.component"],function(exports_39,context_39){"use strict";var core_26,common_4,rule_class_1,operator_helper_class_1,money_enums_9,rule_condition_validator_class_1,rule_rest_service_2,rule_service_3,category_rest_service_7,display_error_directive_2,money_pipes_4,admin_menu_component_2,FieldHelper,AdminRuleComponent;context_39&&context_39.id;return{setters:[function(core_26_1){core_26=core_26_1},function(common_4_1){common_4=common_4_1},function(rule_class_1_1){rule_class_1=rule_class_1_1},function(operator_helper_class_1_1){operator_helper_class_1=operator_helper_class_1_1},function(money_enums_9_1){money_enums_9=money_enums_9_1},function(rule_condition_validator_class_1_1){rule_condition_validator_class_1=rule_condition_validator_class_1_1},function(rule_rest_service_2_1){rule_rest_service_2=rule_rest_service_2_1},function(rule_service_3_1){rule_service_3=rule_service_3_1},function(category_rest_service_7_1){category_rest_service_7=category_rest_service_7_1},function(display_error_directive_2_1){display_error_directive_2=display_error_directive_2_1},function(money_pipes_4_1){money_pipes_4=money_pipes_4_1},function(admin_menu_component_2_1){admin_menu_component_2=admin_menu_component_2_1}],execute:function(){FieldHelper=function(){function FieldHelper(index,name,label,type){this.index=index,this.name=name,this.label=label,this.type=type}return FieldHelper}(),AdminRuleComponent=function(){function AdminRuleComponent(_ruleRestService,_categoryRestService,fb,elementRef,_ruleService){var _this=this;this._ruleRestService=_ruleRestService,this._categoryRestService=_categoryRestService,this.elementRef=elementRef,this._ruleService=_ruleService,this.formMode="create",this.newRule=new rule_class_1.Rule,this.fieldNames=[],this.stringOperators=[],this.numOperators=[],this._categoryRestService.list().subscribe(function(categories){_this.categories=categories}),this._ruleRestService.list().subscribe(function(rules){_this.rules=rules,console.log(rules)});var ruleConditionValidator=new rule_condition_validator_class_1.RuleConditionValidator(this);this.dummyFieldConditionsControl=fb.control("",ruleConditionValidator.validate),this.stringOperators.push(new operator_helper_class_1.OperatorHelper(money_enums_9.CondOperator.EQUAL,"equals")),this.stringOperators.push(new operator_helper_class_1.OperatorHelper(money_enums_9.CondOperator.CONTAINS,"contains")),this.numOperators.push(new operator_helper_class_1.OperatorHelper(money_enums_9.CondOperator.EQUAL,"equals")),this.numOperators.push(new operator_helper_class_1.OperatorHelper(money_enums_9.CondOperator.GREATERTHAN,"is greater than")),this.numOperators.push(new operator_helper_class_1.OperatorHelper(money_enums_9.CondOperator.LOWERTHAN,"is lower than")),this.fieldNames.push(new FieldHelper(0,"amount","Amount",money_enums_9.CondFieldType.NUMBER)),this.fieldNames.push(new FieldHelper(1,"communication","Communication",money_enums_9.CondFieldType.STRING)),this.fieldNames.push(new FieldHelper(2,"comment","Description",money_enums_9.CondFieldType.STRING)),this.fieldNames.push(new FieldHelper(3,"thirdPartyAccountName","Third-party account name",money_enums_9.CondFieldType.STRING)),this.fieldNames.push(new FieldHelper(4,"thirdPartyAccountNumber","Third-party account number",money_enums_9.CondFieldType.STRING)),this.createForm=fb.group({name:fb.control("",common_4.Validators.compose([common_4.Validators.required,common_4.Validators.minLength(3),common_4.Validators.maxLength(50)])),catType:fb.control("",common_4.Validators.required),catFrequency:fb.control("",common_4.Validators.required),catId:fb.control("",common_4.Validators.required),conditions:this.dummyFieldConditionsControl})}return AdminRuleComponent.prototype.fieldChanged=function(condition,$event){condition.fieldName=this.fieldNames[$event.target.value].name,condition.fieldType=this.fieldNames[$event.target.value].type,condition.valueStr=void 0,condition.valueNum=void 0,this.dummyFieldConditionsControl.updateValue($event)},AdminRuleComponent.prototype.onConditionUpdated=function($event){this.dummyFieldConditionsControl.markAsDirty(),this.dummyFieldConditionsControl.updateValue($event)},AdminRuleComponent.prototype.onAddCondition=function(){this.newRule.conditions.push(new rule_class_1.Condition),this.dummyFieldConditionsControl.updateValue("add")},AdminRuleComponent.prototype.onRemoveCondition=function(){this.newRule.conditions.pop(),this.dummyFieldConditionsControl.updateValue("remove")},AdminRuleComponent.prototype.onCatTypeChanged=function($event){this.newRule.category.type=money_enums_9.CatType[$event.target.value]},AdminRuleComponent.prototype.onCatFrequencyChanged=function($event){this.newRule.category.frequency=money_enums_9.CatFrequency[$event.target.value]},AdminRuleComponent.prototype.onSubmit=function(){var _this=this;"create"===this.formMode?this._ruleRestService.create(this.newRule).subscribe(function(newrule){newrule.category=_this.categories.filter(function(category){return category.id===_this.newRule.categoryId}).pop(),_this.rules.push(newrule),console.log("Rule added"),_this._ruleService.reloadRules(),_this.newRule=new rule_class_1.Rule},function(err){return console.log(err)}):"edit"===this.formMode&&this._ruleRestService.update(this.newRule).subscribe(function(updatedrule){updatedrule.category=_this.categories.filter(function(category){return category.id===_this.newRule.categoryId}).pop(),_this.rules[_this.editedRuleIndex]=updatedrule,console.log("Rule updated"),_this._ruleService.reloadRules(),_this.newRule=new rule_class_1.Rule,_this.formMode="create"},function(err){return console.log(err)})},AdminRuleComponent.prototype.onDisable=function(rule){var _this=this;rule.isActive=!1,this._ruleRestService.update(rule).subscribe(function(data){console.log("Rule updated"),_this._ruleService.reloadRules()},function(err){return console.log(err)})},AdminRuleComponent.prototype.onEnable=function(rule){var _this=this;rule.isActive=!0,this._ruleRestService.update(rule).subscribe(function(data){console.log("Rule updated"),_this._ruleService.reloadRules()},function(err){return console.log(err)})},AdminRuleComponent.prototype.onDelete=function(rule,j){var _this=this;this._ruleRestService["delete"](rule.id).subscribe(function(data){_this.rules.splice(j,1),console.log("Rule deleted"),_this._ruleService.reloadRules()},function(err){return console.log(err)})},AdminRuleComponent.prototype.onEdit=function(rule,j){this.editedRuleIndex=j,this.formMode="edit",this.newRule=rule,this.dummyFieldConditionsControl.updateValue(j)},AdminRuleComponent.prototype.onCancelEdit=function($event){$event.preventDefault(),this.newRule=new rule_class_1.Rule,this.formMode="create"},AdminRuleComponent.prototype.getConditionsForRule=function(rule){for(var tooltip="",_i=0,_a=rule.conditions;_i<_a.length;_i++){var cond=_a[_i];""!==tooltip&&(tooltip+=" and "),cond.fieldType===money_enums_9.CondFieldType.STRING?tooltip+=cond.fieldName+" "+cond.operator+" '"+cond.valueStr+"'":cond.fieldType===money_enums_9.CondFieldType.NUMBER&&(tooltip+=cond.fieldName+" "+cond.operator+" '"+cond.valueNum+"'")}return tooltip},AdminRuleComponent=__decorate([core_26.Component({selector:"money-admin-rule",templateUrl:"assets/html/admin/rule.html",directives:[display_error_directive_2.DisplayErrorDirective,admin_menu_component_2.AdminMenuComponent],pipes:[money_pipes_4.CatfilterPipe,money_pipes_4.CategorySorterPipe]}),__metadata("design:paramtypes",[rule_rest_service_2.RuleRestService,category_rest_service_7.CategoryRestService,common_4.FormBuilder,core_26.ElementRef,rule_service_3.RuleService])],AdminRuleComponent)}(),exports_39("AdminRuleComponent",AdminRuleComponent)}}}),System.register("model/validation/account-form-validator.class",[],function(exports_40,context_40){"use strict";var AccountFormValidator;context_40&&context_40.id;return{setters:[],execute:function(){AccountFormValidator=function(){function AccountFormValidator(component){var validator=this;validator.validate=function(control){return validator.validateMapping(component)}}return AccountFormValidator.prototype.validateMapping=function(component){for(var amount=0,comm=0,date=0,desc=0,id=0,thirdPartyAccountName=0,thirdPartyAccountNumber=0,mappingOk=!0,_i=0,_a=component.accountSetting.fieldMappings;_i<_a.length;_i++){var mapper=_a[_i];switch(mapper.value){case"ignore":break;case"amount":amount++;break;case"communication":comm++;break;case"date":date++;break;case"description":desc++;break;case"id":id++;break;case"third-party-account-name":thirdPartyAccountName++;break;case"third-party-account-number":thirdPartyAccountNumber++}}return(1!==amount||1!==comm||1!==date||desc>1||id>1||1!==id&&!component.accountSetting.generateIdentifier||1===id&&component.accountSetting.generateIdentifier||1!==thirdPartyAccountName||1!==thirdPartyAccountNumber)&&(mappingOk=!1),mappingOk&&this.validTxDate(component)&&this.validAmount(component)?null:{wrongMapping:!0}},AccountFormValidator.prototype.validTxDate=function(component){for(var mapping,_i=0,_a=component.accountSetting.fieldMappings;_i<_a.length;_i++){var mapper=_a[_i];"date"===mapper.value&&(mapping=mapper)}var dateStr=component.lineTokens[mapping.index];return this.isDateDMY(dateStr)&&(mapping.isDateDMY=!0),this.isDateYMD(dateStr)&&(mapping.isDateYMD=!0),mapping.isDateDMY||mapping.isDateYMD},AccountFormValidator.prototype.validAmount=function(component){for(var mapping,_i=0,_a=component.accountSetting.fieldMappings;_i<_a.length;_i++){var mapper=_a[_i];"amount"===mapper.value&&(mapping=mapper)}var amountStr=component.lineTokens[mapping.index];return amountStr=amountStr.replace(/[.]/g,"").replace(/,/g,"."),isNaN(Number(amountStr))||(mapping.isBelgianNumber=!0),mapping.isBelgianNumber},AccountFormValidator.prototype.isDateDMY=function(str){var parms=str.split(/[\.\-\/]/),yyyy=parseInt(parms[2],10),mm=parseInt(parms[1],10),dd=parseInt(parms[0],10),date=new Date(yyyy,mm-1,dd,0,0,0,0);return mm===date.getMonth()+1&&dd===date.getDate()&&yyyy===date.getFullYear()},AccountFormValidator.prototype.isDateYMD=function(str){var parms=str.split(/[\.\-\/]/),yyyy=parseInt(parms[0],10),mm=parseInt(parms[1],10),dd=parseInt(parms[2],10),date=new Date(yyyy,mm-1,dd,0,0,0,0);return mm===date.getMonth()+1&&dd===date.getDate()&&yyyy===date.getFullYear()},AccountFormValidator.prototype.isValidNumber=function(control){return isNaN(control.value)?{wrongNumber:!0}:null},AccountFormValidator}(),exports_40("AccountFormValidator",AccountFormValidator)}}}),System.register("model/formutil/multipart-item.class",[],function(exports_41,context_41){"use strict";var MultipartItem;context_41&&context_41.id;return{setters:[],execute:function(){MultipartItem=function(){function MultipartItem(uploader){this.uploader=uploader,this.alias="file",this.url="/",this.method="POST",this.headers=[],this.withCredentials=!0,this.formData=null,this.isReady=!1,this.isUploading=!1,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!1,this.isError=!1,this.progress=0,this.index=null,this.callback=null}return MultipartItem.prototype.upload=function(){try{console.debug("multipart-item.ts & upload() ==>."),this.uploader.uploadItem(this)}catch(e){}},MultipartItem.prototype.init=function(){this.isReady=!1,this.isUploading=!1,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!1,this.isError=!1,this.progress=0,this.formData=null,this.callback=null},MultipartItem.prototype.onBeforeUpload=function(){},MultipartItem.prototype.onProgress=function(progress){},MultipartItem.prototype.onSuccess=function(response,status,headers){},MultipartItem.prototype.onError=function(response,status,headers){},MultipartItem.prototype.onCancel=function(response,status,headers){},MultipartItem.prototype.onComplete=function(response,status,headers){this.callback(response),this.init()},MultipartItem.prototype._onBeforeUpload=function(){this.isReady=!0,this.isUploading=!0,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!1,this.isError=!1,this.progress=0,this.onBeforeUpload()},MultipartItem.prototype._onProgress=function(progress){this.progress=progress,this.onProgress(progress)},MultipartItem.prototype._onSuccess=function(response,status,headers){this.isReady=!1,this.isUploading=!1,this.isUploaded=!0,this.isSuccess=!0,this.isCancel=!1,this.isError=!1,this.progress=100,this.index=null,this.onSuccess(response,status,headers)},MultipartItem.prototype._onError=function(response,status,headers){this.isReady=!1,this.isUploading=!1,this.isUploaded=!0,this.isSuccess=!1,this.isCancel=!1,this.isError=!0,this.progress=0,this.index=null,this.onError(response,status,headers),this.callback(response)},MultipartItem.prototype._onCancel=function(response,status,headers){this.isReady=!1,this.isUploading=!1,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!0,this.isError=!1,this.progress=0,this.index=null,this.onCancel(response,status,headers)},MultipartItem.prototype._onComplete=function(response,status,headers){this.onComplete(response,status,headers)},MultipartItem.prototype._prepareToUploading=function(){this.isReady=!0},MultipartItem}(),exports_41("MultipartItem",MultipartItem)}}}),System.register("model/formutil/multipart-uploader.class",[],function(exports_42,context_42){"use strict";var MultipartUploader;context_42&&context_42.id;return{setters:[],execute:function(){MultipartUploader=function(){function MultipartUploader(options){this.options=options,this.isUploading=!1,this.progress=0,this.isHTML5=!0,this.url=options.url,this.authToken=options.authToken}return MultipartUploader.prototype.uploadItem=function(item){return console.debug("multipart-uploader.ts & uploadItem() ==>."),this.isUploading?void console.debug("multipart-uploader.ts & uploadItem() uploader is uploading now."):(this.isUploading=!0,void this._xhrTransport(item))},MultipartUploader.prototype._onBeforeUploadItem=function(item){item._onBeforeUpload()},MultipartUploader.prototype._parseHeaders=function(headers){var key,val,i,parsed={};return headers?(headers.split("\n").map(function(line){i=line.indexOf(":"),key=line.slice(0,i).trim().toLowerCase(),val=line.slice(i+1).trim(),key&&(parsed[key]=parsed[key]?parsed[key]+", "+val:val)}),parsed):parsed},MultipartUploader.prototype._transformResponse=function(response,headers){return response},MultipartUploader.prototype._isSuccessCode=function(status){return status>=200&&300>status||304===status},MultipartUploader.prototype._render=function(){},MultipartUploader.prototype._xhrTransport=function(item){var _this=this;console.debug("multipart-uploader.ts & _xhrTransport() ==>.");var xhr=item._xhr=new XMLHttpRequest;this._onBeforeUploadItem(item),xhr.upload.onprogress=function(event){},xhr.onload=function(){console.debug("multipart-uploader.ts & _xhrTransport.onload() ==>");var headers=_this._parseHeaders(xhr.getAllResponseHeaders()),response=_this._transformResponse(xhr.response,headers),gist=_this._isSuccessCode(xhr.status)?"Success":"Error",method="_on"+gist+"Item";_this[method](item,response,xhr.status,headers),_this._onCompleteItem(item,response,xhr.status,headers)},xhr.onerror=function(){console.debug("multipart-uploader.ts & _xhrTransport.onerror() ==>");var headers=_this._parseHeaders(xhr.getAllResponseHeaders()),response=_this._transformResponse(xhr.response,headers);_this._onErrorItem(item,response,xhr.status,headers)},xhr.onabort=function(){console.debug("multipart-uploader.ts & _xhrTransport.onabort() ==>");var headers=_this._parseHeaders(xhr.getAllResponseHeaders()),response=_this._transformResponse(xhr.response,headers);_this._onCompleteItem(item,response,xhr.status,headers)},xhr.open(item.method,this.url,!0),xhr.withCredentials=item.withCredentials,this.authToken&&xhr.setRequestHeader("Authorization",this.authToken),console.debug("multipart-uploader.ts & _xhrTransport() send..."),xhr.send(item.formData),this._render()},MultipartUploader.prototype.onSuccessItem=function(item,response,status,headers){},MultipartUploader.prototype.onErrorItem=function(item,response,status,headers){this.isUploading=!1},MultipartUploader.prototype.onCancelItem=function(item,response,status,headers){},MultipartUploader.prototype.onCompleteItem=function(item,response,status,headers){},MultipartUploader.prototype._onSuccessItem=function(item,response,status,headers){item._onSuccess(response,status,headers),this.onSuccessItem(item,response,status,headers)},MultipartUploader.prototype._onErrorItem=function(item,response,status,headers){console.debug("multipart-uploader.ts & _onErrorItem() ==> Error status:"+status),item._onError(response,status,headers),this.onErrorItem(item,response,status,headers)},MultipartUploader.prototype._onCancelItem=function(item,response,status,headers){item._onCancel(response,status,headers),this.onCancelItem(item,response,status,headers)},MultipartUploader.prototype._onCompleteItem=function(item,response,status,headers){item._onComplete(response,status,headers),this.onCompleteItem(item,response,status,headers),this.isUploading=!1,this._render()},MultipartUploader}(),exports_42("MultipartUploader",MultipartUploader)}}}),System.register("service/upload-csv.service",["@angular/core","@angular/http","model/formutil/multipart-uploader.class","model/formutil/multipart-item.class"],function(exports_43,context_43){"use strict";var core_27,http_8,multipart_uploader_class_1,multipart_item_class_1,UploadCsvService;context_43&&context_43.id;return{setters:[function(core_27_1){core_27=core_27_1},function(http_8_1){http_8=http_8_1},function(multipart_uploader_class_1_1){multipart_uploader_class_1=multipart_uploader_class_1_1},function(multipart_item_class_1_1){multipart_item_class_1=multipart_item_class_1_1}],execute:function(){UploadCsvService=function(){function UploadCsvService(_http){this._http=_http}return UploadCsvService.prototype.uploadFile=function(uploadUrl,file,successCallback,failureCallback){var uploader=new multipart_uploader_class_1.MultipartUploader({url:uploadUrl}),item=new multipart_item_class_1.MultipartItem(uploader);item.formData=new FormData,item.formData.append("csvfile",file);var uploadCallback=function(response){var resp=JSON.parse(response);item.isError?failureCallback(resp):successCallback(resp)};item.callback=uploadCallback,item.upload()},UploadCsvService=__decorate([core_27.Injectable(),__metadata("design:paramtypes",[http_8.Http])],UploadCsvService)}(),exports_43("UploadCsvService",UploadCsvService)}}}),System.register("comp/admin/admin-account-setting.component",["@angular/core","@angular/common","@angular/http","model/core/account-setting.class","model/core/field-mapping.class","model/validation/account-form-validator.class","service/account-setting-rest.service","service/form-utils.service","service/upload-csv.service","comp/directive/display-error.directive","comp/admin/admin-menu.component"],function(exports_44,context_44){"use strict";var core_28,common_5,http_9,account_setting_class_1,field_mapping_class_1,account_form_validator_class_1,account_setting_rest_service_3,form_utils_service_5,upload_csv_service_1,display_error_directive_3,admin_menu_component_3,AdminAccountSettingComponent;context_44&&context_44.id;return{setters:[function(core_28_1){core_28=core_28_1},function(common_5_1){common_5=common_5_1},function(http_9_1){http_9=http_9_1},function(account_setting_class_1_1){account_setting_class_1=account_setting_class_1_1},function(field_mapping_class_1_1){field_mapping_class_1=field_mapping_class_1_1},function(account_form_validator_class_1_1){account_form_validator_class_1=account_form_validator_class_1_1},function(account_setting_rest_service_3_1){account_setting_rest_service_3=account_setting_rest_service_3_1},function(form_utils_service_5_1){form_utils_service_5=form_utils_service_5_1},function(upload_csv_service_1_1){upload_csv_service_1=upload_csv_service_1_1},function(display_error_directive_3_1){display_error_directive_3=display_error_directive_3_1},function(admin_menu_component_3_1){admin_menu_component_3=admin_menu_component_3_1}],execute:function(){AdminAccountSettingComponent=function(){function AdminAccountSettingComponent(_http,fb,_accountSettingRestService,_formUtilsService,_uploadCsvService){var _this=this;this._http=_http,this._accountSettingRestService=_accountSettingRestService,this._formUtilsService=_formUtilsService,this._uploadCsvService=_uploadCsvService,this.accountSetting=new account_setting_class_1.AccountSetting;var accountFormValidator=new account_form_validator_class_1.AccountFormValidator(this);this.dummyFieldMappingControl=fb.control("",accountFormValidator.validate),this.dummyFieldMappingControl.markAsDirty(),this.accountForm=fb.group({name:fb.control("",common_5.Validators.compose([common_5.Validators.required,common_5.Validators.minLength(3),common_5.Validators.maxLength(30)])),accountNumber:fb.control("",common_5.Validators.compose([common_5.Validators.required,common_5.Validators.minLength(16),common_5.Validators.maxLength(16)])),csvfile:fb.control(""),fileStartsWith:fb.control("",common_5.Validators.compose([common_5.Validators.required])),headerLinesCount:fb.control("",accountFormValidator.isValidNumber),fieldSeparator:fb.control("",common_5.Validators.compose([common_5.Validators.required,common_5.Validators.minLength(1),common_5.Validators.maxLength(1)])),fieldMapping:this.dummyFieldMappingControl}),this._accountSettingRestService.list().subscribe(function(accountSettings){_this.allAccountSettings=accountSettings})}return AdminAccountSettingComponent.prototype.onSettingChange=function(value){value&&this.updateTokens(this)},AdminAccountSettingComponent.prototype.updateTokens=function(thisComp){if(thisComp.accountSetting.headerLinesCount<thisComp.fileFirstLines.length){thisComp.lineTokens=thisComp.fileFirstLines[thisComp.accountSetting.headerLinesCount].split(thisComp.accountSetting.fieldSeparator),thisComp.accountSetting.fieldMappings=[];for(var index=0,_i=0,_a=thisComp.lineTokens;_i<_a.length;_i++){_a[_i];thisComp.accountSetting.fieldMappings.push(new field_mapping_class_1.FieldMapping("ignore",index++))}}},AdminAccountSettingComponent.prototype.onMappingChange=function($event){this.dummyFieldMappingControl.updateValue($event)},AdminAccountSettingComponent.prototype.onCsvSampleUpload=function(fileinput){var UPLOAD_URL="/uploadsample",sampleCsvFile=fileinput.target.files[0],adminCsvComp=this,successCallback=function(response){adminCsvComp.accountForm.controls.csvfile.setErrors(void 0);var allLines=JSON.parse(response);adminCsvComp.fileFirstLines=allLines.slice(0,15),adminCsvComp.updateTokens(adminCsvComp)},failureCallback=function(response){
adminCsvComp.accountForm.controls.csvfile.setErrors({uploadfailed:!0})};this._uploadCsvService.uploadFile(UPLOAD_URL,sampleCsvFile,successCallback,failureCallback)},AdminAccountSettingComponent.prototype.createAccount=function(){var _this=this;this._accountSettingRestService.create(this.accountSetting).subscribe(function(response){_this.allAccountSettings.push(response.json()),_this.accountSetting=new account_setting_class_1.AccountSetting,_this.fileFirstLines=void 0,_this.lineTokens=void 0,_this._formUtilsService.reset(_this.accountForm,"csvfile")})},AdminAccountSettingComponent.prototype.onDelete=function(accountSetting){var _this=this,settingIndex=this.allAccountSettings.indexOf(accountSetting);settingIndex>-1?this._accountSettingRestService["delete"](accountSetting.id).subscribe(function(response){_this.allAccountSettings.splice(settingIndex,1)}):console.error("Cannot find AccountSettingRestService to delete with id ",accountSetting.id)},AdminAccountSettingComponent=__decorate([core_28.Component({selector:"money-admin-account-setting",templateUrl:"assets/html/admin/account-setting.html",styleUrls:["assets/css/admin/account-setting.css"],directives:[display_error_directive_3.DisplayErrorDirective,admin_menu_component_3.AdminMenuComponent]}),__metadata("design:paramtypes",[http_9.Http,common_5.FormBuilder,account_setting_rest_service_3.AccountSettingRestService,form_utils_service_5.FormUtilsService,upload_csv_service_1.UploadCsvService])],AdminAccountSettingComponent)}(),exports_44("AdminAccountSettingComponent",AdminAccountSettingComponent)}}}),System.register("comp/admin/admin-uploads.component",["@angular/core","@angular/common","service/upload-csv.service","comp/directive/display-error.directive","service/csv-files-rest.service"],function(exports_45,context_45){"use strict";var core_29,common_6,upload_csv_service_2,display_error_directive_4,csv_files_rest_service_3,AdminUploadsComponent;context_45&&context_45.id;return{setters:[function(core_29_1){core_29=core_29_1},function(common_6_1){common_6=common_6_1},function(upload_csv_service_2_1){upload_csv_service_2=upload_csv_service_2_1},function(display_error_directive_4_1){display_error_directive_4=display_error_directive_4_1},function(csv_files_rest_service_3_1){csv_files_rest_service_3=csv_files_rest_service_3_1}],execute:function(){AdminUploadsComponent=function(){function AdminUploadsComponent(fb,_uploadCsvService,_csvFilesRestService){var _this=this;this._uploadCsvService=_uploadCsvService,this._csvFilesRestService=_csvFilesRestService,this.uploadForm=fb.group({csvfile:fb.control("")}),this._csvFilesRestService.getCsvNames().subscribe(function(fileNames){_this.csvFilenames=fileNames}),this._csvFilesRestService.getDefaultCsvPath().subscribe(function(resp){_this.defaultCsvPath=resp.path})}return AdminUploadsComponent.prototype.onCsvUpload=function(fileinput){var UPLOAD_URL="/uploadcsv",csvFile=fileinput.target.files[0],adminUploadComp=this,successCallback=function(response){adminUploadComp.uploadForm.controls.csvfile.setErrors(void 0),adminUploadComp.csvFilenames.push(response.fileName)},failureCallback=function(response){adminUploadComp.uploadForm.controls.csvfile.setErrors({uploadfailed:!0})};this._uploadCsvService.uploadFile(UPLOAD_URL,csvFile,successCallback,failureCallback)},AdminUploadsComponent.prototype.onDelete=function(csvFilename){var _this=this;this._csvFilesRestService.deleteFile(csvFilename).subscribe(function(result){_this.csvFilenames=_this.csvFilenames.filter(function(elem){return elem!==csvFilename}),console.log(csvFilename,"was deleted")})},AdminUploadsComponent=__decorate([core_29.Component({selector:"money-admin-uploads",templateUrl:"assets/html/admin/uploads.html",styleUrls:["assets/css/admin/uploads.css"],directives:[display_error_directive_4.DisplayErrorDirective]}),__metadata("design:paramtypes",[common_6.FormBuilder,upload_csv_service_2.UploadCsvService,csv_files_rest_service_3.CsvFilesRestService])],AdminUploadsComponent)}(),exports_45("AdminUploadsComponent",AdminUploadsComponent)}}}),System.register("comp/admin/admin-preset.component",["@angular/core","@angular/common","service/filter-preset-rest.service","comp/directive/display-error.directive","comp/directive/focus-on-init.directive","comp/admin/admin-menu.component"],function(exports_46,context_46){"use strict";var core_30,common_7,filter_preset_rest_service_2,display_error_directive_5,focus_on_init_directive_3,admin_menu_component_4,AdminPresetComponent;context_46&&context_46.id;return{setters:[function(core_30_1){core_30=core_30_1},function(common_7_1){common_7=common_7_1},function(filter_preset_rest_service_2_1){filter_preset_rest_service_2=filter_preset_rest_service_2_1},function(display_error_directive_5_1){display_error_directive_5=display_error_directive_5_1},function(focus_on_init_directive_3_1){focus_on_init_directive_3=focus_on_init_directive_3_1},function(admin_menu_component_4_1){admin_menu_component_4=admin_menu_component_4_1}],execute:function(){AdminPresetComponent=function(){function AdminPresetComponent(_filterPresetRestService,fb){var _this=this;this._filterPresetRestService=_filterPresetRestService,this.filterPresets=[],this._filterPresetRestService.list().subscribe(function(allPresets){_this.filterPresets=allPresets}),this.editForm=fb.group({presetName:fb.control("",common_7.Validators.required)})}return AdminPresetComponent.prototype.onDelete=function(preset,index){var _this=this;this._filterPresetRestService["delete"](preset.id).subscribe(function(resp){console.log("Preset delete"),_this.filterPresets.splice(index,1)},function(err){return console.log(err)})},AdminPresetComponent.prototype.onEdit=function(preset){this.editedPreset=preset},AdminPresetComponent.prototype.onCancelEdit=function($event){$event.preventDefault(),this.editedPreset=void 0},AdminPresetComponent.prototype.onUpdate=function(){var _this=this;this.editedPreset&&this._filterPresetRestService.update(this.editedPreset).subscribe(function(preset){console.log("Preset updated"),_this.editedPreset=void 0})},AdminPresetComponent=__decorate([core_30.Component({selector:"money-admin-preset",templateUrl:"assets/html/admin/preset.html",directives:[display_error_directive_5.DisplayErrorDirective,focus_on_init_directive_3.FocusOnInitDirective,admin_menu_component_4.AdminMenuComponent]}),__metadata("design:paramtypes",[filter_preset_rest_service_2.FilterPresetRestService,common_7.FormBuilder])],AdminPresetComponent)}(),exports_46("AdminPresetComponent",AdminPresetComponent)}}}),System.register("comp/app.component",["@angular/core","@angular/router","comp/home/home.component","comp/import/import.component","comp/import/auto-import.component","comp/preferences/preferences.component","comp/admin/admin-category.component","comp/admin/admin-rule.component","comp/admin/admin-account-setting.component","comp/admin/admin-uploads.component","comp/admin/admin-preset.component"],function(exports_47,context_47){"use strict";var core_31,router_1,home_component_1,import_component_1,auto_import_component_1,preferences_component_1,admin_category_component_1,admin_rule_component_1,admin_account_setting_component_1,admin_uploads_component_1,admin_preset_component_1,AppComponent;context_47&&context_47.id;return{setters:[function(core_31_1){core_31=core_31_1},function(router_1_1){router_1=router_1_1},function(home_component_1_1){home_component_1=home_component_1_1},function(import_component_1_1){import_component_1=import_component_1_1},function(auto_import_component_1_1){auto_import_component_1=auto_import_component_1_1},function(preferences_component_1_1){preferences_component_1=preferences_component_1_1},function(admin_category_component_1_1){admin_category_component_1=admin_category_component_1_1},function(admin_rule_component_1_1){admin_rule_component_1=admin_rule_component_1_1},function(admin_account_setting_component_1_1){admin_account_setting_component_1=admin_account_setting_component_1_1},function(admin_uploads_component_1_1){admin_uploads_component_1=admin_uploads_component_1_1},function(admin_preset_component_1_1){admin_preset_component_1=admin_preset_component_1_1}],execute:function(){AppComponent=function(){function AppComponent(){}return AppComponent=__decorate([router_1.Routes([{path:"/home",component:home_component_1.HomeComponent},{path:"/import",component:import_component_1.ImportComponent},{path:"/auto-import",component:auto_import_component_1.AutoImportComponent},{path:"/uploads",component:admin_uploads_component_1.AdminUploadsComponent},{path:"/preferences",component:preferences_component_1.PreferencesComponent},{path:"/admin-category",component:admin_category_component_1.AdminCategoryComponent},{path:"/admin-account-setting",component:admin_account_setting_component_1.AdminAccountSettingComponent},{path:"/admin-rule",component:admin_rule_component_1.AdminRuleComponent},{path:"/admin-preset",component:admin_preset_component_1.AdminPresetComponent}]),core_31.Component({selector:"money-app",templateUrl:"assets/html/index.html",encapsulation:core_31.ViewEncapsulation.None,styleUrls:["assets/css/master.css"]}),__metadata("design:paramtypes",[])],AppComponent)}(),exports_47("AppComponent",AppComponent)}}}),System.register("model/config/json-request-options",["@angular/http"],function(exports_48,context_48){"use strict";var http_10,JsonRequestOptions;context_48&&context_48.id;return{setters:[function(http_10_1){http_10=http_10_1}],execute:function(){JsonRequestOptions=function(_super){function JsonRequestOptions(){_super.call(this,{headers:new http_10.Headers({"Content-Type":"application/json; charset=utf-8",Accept:"application/json"})})}return __extends(JsonRequestOptions,_super),JsonRequestOptions}(http_10.RequestOptions),exports_48("JsonRequestOptions",JsonRequestOptions)}}}),System.register("boot",["@angular/core","@angular/router","@angular/common","@angular/http","@angular/platform-browser-dynamic","comp/app.component","service/display-param.service","service/category-rest.service","service/account-setting-rest.service","service/preference-rest.service","service/txref-rest.service","service/rule-rest.service","service/rule.service","service/csv-files-rest.service","service/filter-preset-rest.service","service/form-utils.service","service/upload-csv.service","model/utils/category-years-checker","model/config/json-request-options"],function(exports_49,context_49){"use strict";var core_32,router_2,common_8,http_11,platform_browser_dynamic_1,app_component_1,display_param_service_3,category_rest_service_8,account_setting_rest_service_4,preference_rest_service_4,txref_rest_service_4,rule_rest_service_3,rule_service_4,csv_files_rest_service_4,filter_preset_rest_service_3,form_utils_service_6,upload_csv_service_3,category_years_checker_2,json_request_options_1;context_49&&context_49.id;return{setters:[function(core_32_1){core_32=core_32_1},function(router_2_1){router_2=router_2_1},function(common_8_1){common_8=common_8_1},function(http_11_1){http_11=http_11_1},function(platform_browser_dynamic_1_1){platform_browser_dynamic_1=platform_browser_dynamic_1_1},function(app_component_1_1){app_component_1=app_component_1_1},function(display_param_service_3_1){display_param_service_3=display_param_service_3_1},function(category_rest_service_8_1){category_rest_service_8=category_rest_service_8_1},function(account_setting_rest_service_4_1){account_setting_rest_service_4=account_setting_rest_service_4_1},function(preference_rest_service_4_1){preference_rest_service_4=preference_rest_service_4_1},function(txref_rest_service_4_1){txref_rest_service_4=txref_rest_service_4_1},function(rule_rest_service_3_1){rule_rest_service_3=rule_rest_service_3_1},function(rule_service_4_1){rule_service_4=rule_service_4_1},function(csv_files_rest_service_4_1){csv_files_rest_service_4=csv_files_rest_service_4_1},function(filter_preset_rest_service_3_1){filter_preset_rest_service_3=filter_preset_rest_service_3_1},function(form_utils_service_6_1){form_utils_service_6=form_utils_service_6_1},function(upload_csv_service_3_1){upload_csv_service_3=upload_csv_service_3_1},function(category_years_checker_2_1){category_years_checker_2=category_years_checker_2_1},function(json_request_options_1_1){json_request_options_1=json_request_options_1_1}],execute:function(){platform_browser_dynamic_1.bootstrap(app_component_1.AppComponent,[display_param_service_3.DisplayParamService,category_rest_service_8.CategoryRestService,account_setting_rest_service_4.AccountSettingRestService,preference_rest_service_4.PreferenceRestService,txref_rest_service_4.TxrefRestService,rule_rest_service_3.RuleRestService,rule_service_4.RuleService,csv_files_rest_service_4.CsvFilesRestService,filter_preset_rest_service_3.FilterPresetRestService,form_utils_service_6.FormUtilsService,upload_csv_service_3.UploadCsvService,category_years_checker_2.CategoryYearsChecker,router_2.ROUTER_PROVIDERS,http_11.HTTP_PROVIDERS,core_32.provide(common_8.APP_BASE_HREF,{useValue:"/"}),core_32.provide(http_11.RequestOptions,{useClass:json_request_options_1.JsonRequestOptions}),core_32.provide(common_8.LocationStrategy,{useClass:common_8.HashLocationStrategy}),core_32.provide(core_32.PLATFORM_DIRECTIVES,{useValue:[router_2.ROUTER_DIRECTIVES],multi:!0})])}}}),beforeEach(function(){jasmine.addMatchers({toContainText:function(){return{compare:function(actual,expectedText){var actualText=actual.textContent;return{pass:actualText.indexOf(expectedText)>-1,get message(){return"Expected "+actualText+" to contain "+expectedText}}}}}})}),describe("universal truths",function(){it("should do math",function(){expect(2).toEqual(3),expect(5).toBeGreaterThan(4)}),xit("should skip this",function(){expect(4).toEqual(40)})});